!function(){var t,e,r,i,n="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{};function J(t){return t&&t.__esModule?t.default:t}var o={},s={},a=n.parcelRequire4ff8;null==a&&((a=function(t){if(t in o)return o[t].exports;if(t in s){var e=s[t];delete s[t];var r={id:t,exports:{}};return o[t]=r,e.call(r.exports,r,r.exports),r.exports}var i=Error("Cannot find module '"+t+"'");throw i.code="MODULE_NOT_FOUND",i}).register=function(t,e){s[t]=e},n.parcelRequire4ff8=a);var h=a.register;h("dfbYt",function(t,e){let r;var i=a("6qd2L");e.formatArgs=function(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;let r="color: "+this.color;e.splice(1,0,r,"color: inherit");let i=0,n=0;e[0].replace(/%[a-zA-Z%]/g,t=>{"%%"!==t&&(i++,"%c"===t&&(n=i))}),e.splice(n,0,r)},e.save=function(t){try{t?e.storage.setItem("debug",t):e.storage.removeItem("debug")}catch(t){}},e.load=function(){let t;try{t=e.storage.getItem("debug")}catch(t){}return!t&&void 0!==i&&"env"in i&&(t=void 0),t},e.useColors=function(){return"undefined"!=typeof window&&!!window.process&&("renderer"===window.process.type||!!window.process.__nwjs)||!("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},e.storage=function(){try{return localStorage}catch(t){}}(),e.destroy=(r=!1,()=>{r||(r=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.log=console.debug||console.log||(()=>{}),t.exports=a("35oNV")(e);let{formatters:n}=t.exports;n.j=function(t){try{return JSON.stringify(t)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}}),h("6qd2L",function(t,e){var r,i,n,J=t.exports={};function o(){throw Error("setTimeout has not been defined")}function s(){throw Error("clearTimeout has not been defined")}function a(t){if(r===setTimeout)return setTimeout(t,0);if((r===o||!r)&&setTimeout)return r=setTimeout,setTimeout(t,0);try{return r(t,0)}catch(e){try{return r.call(null,t,0)}catch(e){return r.call(this,t,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:o}catch(t){r=o}try{i="function"==typeof clearTimeout?clearTimeout:s}catch(t){i=s}}();var h=[],l=!1,u=-1;function c(){l&&n&&(l=!1,n.length?h=n.concat(h):u=-1,h.length&&f())}function f(){if(!l){var t=a(c);l=!0;for(var e=h.length;e;){for(n=h,h=[];++u<e;)n&&n[u].run();u=-1,e=h.length}n=null,l=!1,function(t){if(i===clearTimeout)return clearTimeout(t);if((i===s||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(t);try{i(t)}catch(e){try{return i.call(null,t)}catch(e){return i.call(this,t)}}}(t)}}function d(t,e){this.fun=t,this.array=e}function p(){}J.nextTick=function(t){var e=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];h.push(new d(t,e)),1!==h.length||l||a(f)},d.prototype.run=function(){this.fun.apply(null,this.array)},J.title="browser",J.browser=!0,J.env={},J.argv=[],J.version="",J.versions={},J.on=p,J.addListener=p,J.once=p,J.off=p,J.removeListener=p,J.removeAllListeners=p,J.emit=p,J.prependListener=p,J.prependOnceListener=p,J.listeners=function(t){return[]},J.binding=function(t){throw Error("process.binding is not supported")},J.cwd=function(){return"/"},J.chdir=function(t){throw Error("process.chdir is not supported")},J.umask=function(){return 0}}),h("35oNV",function(t,e){t.exports=function(t){function e(t){let i,n,J;let o=null;function s(...t){if(!s.enabled)return;let r=Number(new Date),n=r-(i||r);s.diff=n,s.prev=i,s.curr=r,i=r,t[0]=e.coerce(t[0]),"string"!=typeof t[0]&&t.unshift("%O");let J=0;t[0]=t[0].replace(/%([a-zA-Z%])/g,(r,i)=>{if("%%"===r)return"%";J++;let n=e.formatters[i];if("function"==typeof n){let e=t[J];r=n.call(s,e),t.splice(J,1),J--}return r}),e.formatArgs.call(s,t),(s.log||e.log).apply(s,t)}return s.namespace=t,s.useColors=e.useColors(),s.color=e.selectColor(t),s.extend=r,s.destroy=e.destroy,Object.defineProperty(s,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==o?o:(n!==e.namespaces&&(n=e.namespaces,J=e.enabled(t)),J),set:t=>{o=t}}),"function"==typeof e.init&&e.init(s),s}function r(t,r){let i=e(this.namespace+(void 0===r?":":r)+t);return i.log=this.log,i}function i(t){return t.toString().substring(2,t.toString().length-2).replace(/\.\*\?$/,"*")}return e.debug=e,e.default=e,e.coerce=function(t){return t instanceof Error?t.stack||t.message:t},e.disable=function(){let t=[...e.names.map(i),...e.skips.map(i).map(t=>"-"+t)].join(",");return e.enable(""),t},e.enable=function(t){let r;e.save(t),e.namespaces=t,e.names=[],e.skips=[];let i=("string"==typeof t?t:"").split(/[\s,]+/),n=i.length;for(r=0;r<n;r++)i[r]&&("-"===(t=i[r].replace(/\*/g,".*?"))[0]?e.skips.push(RegExp("^"+t.slice(1)+"$")):e.names.push(RegExp("^"+t+"$")))},e.enabled=function(t){let r,i;if("*"===t[t.length-1])return!0;for(r=0,i=e.skips.length;r<i;r++)if(e.skips[r].test(t))return!1;for(r=0,i=e.names.length;r<i;r++)if(e.names[r].test(t))return!0;return!1},e.humanize=a("eGZ9Z"),e.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(t).forEach(r=>{e[r]=t[r]}),e.names=[],e.skips=[],e.formatters={},e.selectColor=function(t){let r=0;for(let e=0;e<t.length;e++)r=(r<<5)-r+t.charCodeAt(e)|0;return e.colors[Math.abs(r)%e.colors.length]},e.enable(e.load()),e}}),h("eGZ9Z",function(t,e){function r(t,e,r,i){return Math.round(t/r)+" "+i+(e>=1.5*r?"s":"")}t.exports=function(t,e){e=e||{};var i,n,J=typeof t;if("string"===J&&t.length>0)return function(t){if(!((t=String(t)).length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(e){var r=parseFloat(e[1]);switch((e[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*r;case"weeks":case"week":case"w":return 6048e5*r;case"days":case"day":case"d":return 864e5*r;case"hours":case"hour":case"hrs":case"hr":case"h":return 36e5*r;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*r;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}}}(t);if("number"===J&&isFinite(t))return e.long?(i=Math.abs(t))>=864e5?r(t,i,864e5,"day"):i>=36e5?r(t,i,36e5,"hour"):i>=6e4?r(t,i,6e4,"minute"):i>=1e3?r(t,i,1e3,"second"):t+" ms":(n=Math.abs(t))>=864e5?Math.round(t/864e5)+"d":n>=36e5?Math.round(t/36e5)+"h":n>=6e4?Math.round(t/6e4)+"m":n>=1e3?Math.round(t/1e3)+"s":t+"ms";throw Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))}}),h("7jSc9",function(t,e){var r,i,J,o,s,a,h,l,u,c,f,d="__lodash_hash_undefined__",p="[object Arguments]",g="[object Function]",y="[object Object]",m=/^\[object .+?Constructor\]$/,w=/^(?:0|[1-9]\d*)$/,b={};b["[object Float32Array]"]=b["[object Float64Array]"]=b["[object Int8Array]"]=b["[object Int16Array]"]=b["[object Int32Array]"]=b["[object Uint8Array]"]=b["[object Uint8ClampedArray]"]=b["[object Uint16Array]"]=b["[object Uint32Array]"]=!0,b[p]=b["[object Array]"]=b["[object ArrayBuffer]"]=b["[object Boolean]"]=b["[object DataView]"]=b["[object Date]"]=b["[object Error]"]=b[g]=b["[object Map]"]=b["[object Number]"]=b[y]=b["[object RegExp]"]=b["[object Set]"]=b["[object String]"]=b["[object WeakMap]"]=!1;var v="object"==typeof n&&n&&n.Object===Object&&n,_="object"==typeof self&&self&&self.Object===Object&&self,A=v||_||Function("return this")(),E=e&&!e.nodeType&&e,x=E&&t&&!t.nodeType&&t,C=x&&x.exports===E,B=C&&v.process,T=function(){try{var t=x&&x.require&&x.require("util").types;if(t)return t;return B&&B.binding&&B.binding("util")}catch(t){}}(),R=T&&T.isTypedArray,O=Array.prototype,L=Function.prototype,U=Object.prototype,I=A["__core-js_shared__"],D=L.toString,F=U.hasOwnProperty,S=(h=/[^.]+$/.exec(I&&I.keys&&I.keys.IE_PROTO||""))?"Symbol(src)_1."+h:"",M=U.toString,N=D.call(Object),P=RegExp("^"+D.call(F).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),k=C?A.Buffer:void 0,K=A.Symbol,V=A.Uint8Array,j=k?k.allocUnsafe:void 0,G=(l=Object.getPrototypeOf,u=Object,function(t){return l(u(t))}),X=Object.create,Y=U.propertyIsEnumerable,H=O.splice,W=K?K.toStringTag:void 0,z=function(){try{var t=tf(Object,"defineProperty");return t({},"",{}),t}catch(t){}}(),$=k?k.isBuffer:void 0,q=Math.max,Q=Date.now,Z=tf(A,"Map"),tt=tf(Object,"create"),te=function(){function t(){}return function(e){if(!tx(e))return{};if(X)return X(e);t.prototype=e;var r=new t;return t.prototype=void 0,r}}();function tr(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var i=t[e];this.set(i[0],i[1])}}function ti(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var i=t[e];this.set(i[0],i[1])}}function tn(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var i=t[e];this.set(i[0],i[1])}}function tJ(t){var e=this.__data__=new ti(t);this.size=e.size}function to(t,e,r){(void 0===r||tm(t[e],r))&&(void 0!==r||e in t)||ta(t,e,r)}function ts(t,e){for(var r=t.length;r--;)if(tm(t[r][0],e))return r;return -1}function ta(t,e,r){"__proto__"==e&&z?z(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r}tr.prototype.clear=function(){this.__data__=tt?tt(null):{},this.size=0},tr.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},tr.prototype.get=function(t){var e=this.__data__;if(tt){var r=e[t];return r===d?void 0:r}return F.call(e,t)?e[t]:void 0},tr.prototype.has=function(t){var e=this.__data__;return tt?void 0!==e[t]:F.call(e,t)},tr.prototype.set=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=tt&&void 0===e?d:e,this},ti.prototype.clear=function(){this.__data__=[],this.size=0},ti.prototype.delete=function(t){var e=this.__data__,r=ts(e,t);return!(r<0)&&(r==e.length-1?e.pop():H.call(e,r,1),--this.size,!0)},ti.prototype.get=function(t){var e=this.__data__,r=ts(e,t);return r<0?void 0:e[r][1]},ti.prototype.has=function(t){return ts(this.__data__,t)>-1},ti.prototype.set=function(t,e){var r=this.__data__,i=ts(r,t);return i<0?(++this.size,r.push([t,e])):r[i][1]=e,this},tn.prototype.clear=function(){this.size=0,this.__data__={hash:new tr,map:new(Z||ti),string:new tr}},tn.prototype.delete=function(t){var e=tc(this,t).delete(t);return this.size-=e?1:0,e},tn.prototype.get=function(t){return tc(this,t).get(t)},tn.prototype.has=function(t){return tc(this,t).has(t)},tn.prototype.set=function(t,e){var r=tc(this,t),i=r.size;return r.set(t,e),this.size+=r.size==i?0:1,this},tJ.prototype.clear=function(){this.__data__=new ti,this.size=0},tJ.prototype.delete=function(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r},tJ.prototype.get=function(t){return this.__data__.get(t)},tJ.prototype.has=function(t){return this.__data__.has(t)},tJ.prototype.set=function(t,e){var r=this.__data__;if(r instanceof ti){var i=r.__data__;if(!Z||i.length<199)return i.push([t,e]),this.size=++r.size,this;r=this.__data__=new tn(i)}return r.set(t,e),this.size=r.size,this};var th=function(t,e,r){for(var i=-1,n=Object(t),J=r(t),o=J.length;o--;){var s=J[++i];if(!1===e(n[s],s,n))break}return t};function tl(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":W&&W in Object(t)?function(t){var e=F.call(t,W),r=t[W];try{t[W]=void 0;var i=!0}catch(t){}var n=M.call(t);return i&&(e?t[W]=r:delete t[W]),n}(t):M.call(t)}function tu(t){return tC(t)&&tl(t)==p}function tc(t,e){var r,i=t.__data__;return("string"==(r=typeof e)||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==e:null===e)?i["string"==typeof e?"string":"hash"]:i.map}function tf(t,e){var r=null==t?void 0:t[e];return!(!tx(r)||S&&S in r)&&(tA(r)?P:m).test(function(t){if(null!=t){try{return D.call(t)}catch(t){}try{return t+""}catch(t){}}return""}(r))?r:void 0}function td(t,e){var r=typeof t;return!!(e=null==e?9007199254740991:e)&&("number"==r||"symbol"!=r&&w.test(t))&&t>-1&&t%1==0&&t<e}function tp(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||U)}function tg(t,e){if(("constructor"!==e||"function"!=typeof t[e])&&"__proto__"!=e)return t[e]}var ty=(r=z?function(t,e){return z(t,"toString",{configurable:!0,enumerable:!1,value:function(){return e},writable:!0})}:tO,i=0,J=0,function(){var t=Q(),e=16-(t-J);if(J=t,e>0){if(++i>=800)return arguments[0]}else i=0;return r.apply(void 0,arguments)});function tm(t,e){return t===e||t!=t&&e!=e}var tw=tu(function(){return arguments}())?tu:function(t){return tC(t)&&F.call(t,"callee")&&!Y.call(t,"callee")},tb=Array.isArray;function tv(t){return null!=t&&tE(t.length)&&!tA(t)}var t_=$||function(){return!1};function tA(t){if(!tx(t))return!1;var e=tl(t);return e==g||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e}function tE(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991}function tx(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function tC(t){return null!=t&&"object"==typeof t}var tB=R?function(t){return R(t)}:function(t){return tC(t)&&tE(t.length)&&!!b[tl(t)]};function tT(t){return tv(t)?function(t,e){var r=tb(t),i=!r&&tw(t),n=!r&&!i&&t_(t),J=!r&&!i&&!n&&tB(t),o=r||i||n||J,s=o?function(t,e){for(var r=-1,i=Array(t);++r<t;)i[r]=e(r);return i}(t.length,String):[],a=s.length;for(var h in t)(e||F.call(t,h))&&!(o&&("length"==h||n&&("offset"==h||"parent"==h)||J&&("buffer"==h||"byteLength"==h||"byteOffset"==h)||td(h,a)))&&s.push(h);return s}(t,!0):function(t){if(!tx(t))return function(t){var e=[];if(null!=t)for(var r in Object(t))e.push(r);return e}(t);var e=tp(t),r=[];for(var i in t)"constructor"==i&&(e||!F.call(t,i))||r.push(i);return r}(t)}var tR=(c=function(t,e,r){!function t(e,r,i,n,J){e!==r&&th(r,function(o,s){if(J||(J=new tJ),tx(o))(function(t,e,r,i,n,J,o){var s=tg(t,r),a=tg(e,r),h=o.get(a);if(h){to(t,r,h);return}var l=J?J(s,a,r+"",t,e,o):void 0,u=void 0===l;if(u){var c,f,d,p=tb(a),g=!p&&t_(a),m=!p&&!g&&tB(a);l=a,p||g||m?tb(s)?l=s:tC(s)&&tv(s)?l=function(t,e){var r=-1,i=t.length;for(e||(e=Array(i));++r<i;)e[r]=t[r];return e}(s):g?(u=!1,l=function(t,e){if(e)return t.slice();var r=t.length,i=j?j(r):new t.constructor(r);return t.copy(i),i}(a,!0)):m?(u=!1,new V(f=new(c=a.buffer).constructor(c.byteLength)).set(new V(c)),d=f,l=new a.constructor(d,a.byteOffset,a.length)):l=[]:function(t){if(!tC(t)||tl(t)!=y)return!1;var e=G(t);if(null===e)return!0;var r=F.call(e,"constructor")&&e.constructor;return"function"==typeof r&&r instanceof r&&D.call(r)==N}(a)||tw(a)?(l=s,tw(s)?l=function(t,e,r,i){var n=!r;r||(r={});for(var J=-1,o=e.length;++J<o;){var s=e[J],a=void 0;void 0===a&&(a=t[s]),n?ta(r,s,a):function(t,e,r){var i=t[e];F.call(t,e)&&tm(i,r)&&(void 0!==r||e in t)||ta(t,e,r)}(r,s,a)}return r}(s,tT(s)):(!tx(s)||tA(s))&&(l="function"!=typeof a.constructor||tp(a)?{}:te(G(a)))):u=!1}u&&(o.set(a,l),n(l,a,i,J,o),o.delete(a)),to(t,r,l)})(e,r,s,i,t,n,J);else{var a=n?n(tg(e,s),o,s+"",e,r,J):void 0;void 0===a&&(a=o),to(e,s,a)}},tT)}(t,e,r)},ty((o=f=function(t,e){var r=-1,i=e.length,n=i>1?e[i-1]:void 0,J=i>2?e[2]:void 0;for(n=c.length>3&&"function"==typeof n?(i--,n):void 0,J&&function(t,e,r){if(!tx(r))return!1;var i=typeof e;return("number"==i?!!(tv(r)&&td(e,r.length)):"string"==i&&(e in r))&&tm(r[e],t)}(e[0],e[1],J)&&(n=i<3?void 0:n,i=1),t=Object(t);++r<i;){var o=e[r];o&&c(t,o,r,n)}return t},s=void 0,a=tO,s=q(void 0===s?o.length-1:s,0),function(){for(var t=arguments,e=-1,r=q(t.length-s,0),i=Array(r);++e<r;)i[e]=t[s+e];e=-1;for(var n=Array(s+1);++e<s;)n[e]=t[e];return n[s]=a(i),function(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)}(o,this,n)}),f+""));function tO(t){return t}t.exports=tR});var l=a("dfbYt"),u={},c=Object.prototype.hasOwnProperty,f="~";function d(){}function p(t,e,r){this.fn=t,this.context=e,this.once=r||!1}function g(t,e,r,i,n){if("function"!=typeof r)throw TypeError("The listener must be a function");var J=new p(r,i||t,n),o=f?f+e:e;return t._events[o]?t._events[o].fn?t._events[o]=[t._events[o],J]:t._events[o].push(J):(t._events[o]=J,t._eventsCount++),t}function y(t,e){0==--t._eventsCount?t._events=new d:delete t._events[e]}function m(){this._events=new d,this._eventsCount=0}Object.create&&(d.prototype=Object.create(null),new d().__proto__||(f=!1)),m.prototype.eventNames=function(){var t,e,r=[];if(0===this._eventsCount)return r;for(e in t=this._events)c.call(t,e)&&r.push(f?e.slice(1):e);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(t)):r},m.prototype.listeners=function(t){var e=f?f+t:t,r=this._events[e];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,n=r.length,J=Array(n);i<n;i++)J[i]=r[i].fn;return J},m.prototype.listenerCount=function(t){var e=f?f+t:t,r=this._events[e];return r?r.fn?1:r.length:0},m.prototype.emit=function(t,e,r,i,n,J){var o=f?f+t:t;if(!this._events[o])return!1;var s,a,h=this._events[o],l=arguments.length;if(h.fn){switch(h.once&&this.removeListener(t,h.fn,void 0,!0),l){case 1:return h.fn.call(h.context),!0;case 2:return h.fn.call(h.context,e),!0;case 3:return h.fn.call(h.context,e,r),!0;case 4:return h.fn.call(h.context,e,r,i),!0;case 5:return h.fn.call(h.context,e,r,i,n),!0;case 6:return h.fn.call(h.context,e,r,i,n,J),!0}for(a=1,s=Array(l-1);a<l;a++)s[a-1]=arguments[a];h.fn.apply(h.context,s)}else{var u,c=h.length;for(a=0;a<c;a++)switch(h[a].once&&this.removeListener(t,h[a].fn,void 0,!0),l){case 1:h[a].fn.call(h[a].context);break;case 2:h[a].fn.call(h[a].context,e);break;case 3:h[a].fn.call(h[a].context,e,r);break;case 4:h[a].fn.call(h[a].context,e,r,i);break;default:if(!s)for(u=1,s=Array(l-1);u<l;u++)s[u-1]=arguments[u];h[a].fn.apply(h[a].context,s)}}return!0},m.prototype.on=function(t,e,r){return g(this,t,e,r,!1)},m.prototype.once=function(t,e,r){return g(this,t,e,r,!0)},m.prototype.removeListener=function(t,e,r,i){var n=f?f+t:t;if(!this._events[n])return this;if(!e)return y(this,n),this;var J=this._events[n];if(J.fn)J.fn!==e||i&&!J.once||r&&J.context!==r||y(this,n);else{for(var o=0,s=[],a=J.length;o<a;o++)(J[o].fn!==e||i&&!J[o].once||r&&J[o].context!==r)&&s.push(J[o]);s.length?this._events[n]=1===s.length?s[0]:s:y(this,n)}return this},m.prototype.removeAllListeners=function(t){var e;return t?(e=f?f+t:t,this._events[e]&&y(this,e)):(this._events=new d,this._eventsCount=0),this},m.prototype.off=m.prototype.removeListener,m.prototype.addListener=m.prototype.on,m.prefixed=f,m.EventEmitter=m,u=m;class w{constructor(t,e){this.max=t,this._seed=e}cast(t,e){return BigInt.asUintN(e,t)}checkNum(t){if(t>this.max)throw Error(`Number greater than ${this.max}`)}reset(){if(this.constructor===w)throw Error("Method not implemented")}_int(){if(this.constructor===w)throw Error("Method not implemented");return BigInt(0)}bool(){return this.float()>=.5}coin(t=.5){return this.float()<t}int(){return Number(this._int())}bigInt(){return this._int()}float(){return this.int()*(1/this.max)}float53(){return 1/9007199254740992*(67108864*(this.int()>>>5)+(this.int()>>>6))}randRange(t,e){let r=e-t,i=this.max%r,n=this.int();for(;n<i;)n=this.int();return t+n%r}randBelow(t){return this.randRange(0,t)}choice(t){return t[this.randBelow(t.length)]}shuffle(t,e=!0){let r=t;e||(r=Array.from(r));for(let t=r.length-1;t>0;t--){let e=this.randRange(0,t),i=r[t];r[t]=r[e],r[e]=i}return r}initArray(t,e){return Array.from({length:t},e)}boolArray(t){return this.initArray(t,()=>this.bool())}coinArray(t,e=.5){return this.initArray(t,()=>this.coin(e))}intArray(t){return this.initArray(t,()=>this.int())}bigIntArray(t){return this.initArray(t,()=>this.bigInt())}randRangeArray(t,e,r){return this.initArray(t,()=>this.randRange(e,r))}floatArray(t){return this.initArray(t,()=>this.float())}float53Array(t){return this.initArray(t,()=>this.float53())}}var b=w,v=class extends b{constructor(t,e){super(t,e)}int(){return Number(this._int()>>11n)}float(){return this.int()/this.max}float53(){return this.float()}},_=class extends v{constructor(t=Date.now(),e=13,r=7,i=17){super(9007199254740992,BigInt(t)),this.seed=t,this.a=this.cast(BigInt(e),64),this.b=this.cast(BigInt(r),64),this.c=this.cast(BigInt(i),64)}reset(){this.x=this.seed}get seed(){return this._seed}set seed(t){this._seed=this.cast(BigInt(t),64),this.x=this._seed}_int(){let{x:t}=this;return t^=t<<this.a,t=this.cast(t,64),t^=t>>this.b,t^=t<<this.c,t=this.cast(t,64),this.x=t,t}};let A=new _(Date.now());new _(Date.now());var E=Object.defineProperty,x=Object.getOwnPropertyDescriptor,C=(t,e,r,i)=>{for(var n,J=i>1?void 0:i?x(e,r):e,o=t.length-1;o>=0;o--)(n=t[o])&&(J=(i?n(e,r,J):n(J))||J);return i&&J&&E(e,r,J),J};function B(t,e,r,i){return void 0===i&&(i=255),(t<<24)+(e<<16)+(r<<8)+i}var T={BLACK:B(0,0,0),WHITE:B(255,255,255),LIGHT_GRAY:B(170,170,170),DARK_GRAY:B(85,85,85),YELLOW:B(255,255,85),BROWN:B(170,85,0),LIGHT_RED:B(255,85,85),DARK_RED:B(170,0,0),LIGHT_GREEN:B(85,255,85),DARK_GREEN:B(0,170,0),LIGHT_CYAN:B(85,255,255),DARK_CYAN:B(0,170,170),LIGHT_BLUE:B(85,85,255),DARK_BLUE:B(0,0,170),LIGHT_MAGENTA:B(255,85,255),DARK_MAGENTA:B(170,0,170),ORANGE:B(255,136,0)},R=new Map;function O(t){R.set(t.name,t)}var L=class{constructor(t,e,r,i=T.WHITE,n=T.BLACK){this.x=t,this.y=e,void 0!==r?this.charCode="string"==typeof r&&r.length>0?r.charCodeAt(0):r:this.charCode=32,this.fg=i,this.bg=n,this.dirty=!0,this.blocked=!1,this.blockedSight=!1,this.explored=!1,this.visible=!1,this.pathId=-1,this.g=0,this.h=0,this.prev=null}setCharCode(t){this.charCode!==t&&(this.charCode=t,this.dirty=!0)}setForeground(t){null!=t&&t!==this.fg&&(this.fg=t,this.dirty=!0)}setBackground(t){null!=t&&t!==this.bg&&(this.bg=t,this.dirty=!0)}setValue(t,e,r){return"string"==typeof t&&(t=t.charCodeAt(0)),"number"==typeof t?(this.setCharCode(t),void 0!==e&&this.setForeground(e),void 0!==r&&this.setBackground(r)):this.drawCell(t),this.dirty}drawCell(t,e){let r=255&t.bg;!e||t.charCode>0?(this.setCharCode(t.charCode),this.setForeground(t.fg)):r>0&&r<255&&this.setForeground(this.blendColors(this.fg,t.bg,e)),e&&255!==r?r>0&&this.setBackground(this.blendColors(this.bg,t.bg,e)):this.setBackground(t.bg)}blendColors(t,e,r){let i=(255-(255&e))/255,n=1-i,J=t>>24&255,o=t>>16&255,s=t>>8&255,a=e>>24&255,h=e>>16&255,l=e>>8&255;switch(r){case"blend":return B(i*J+n*a|0,i*o+n*h|0,i*s+n*l|0);case"add":return B(this.clamp(J+n*a|0),this.clamp(o+n*h|0),this.clamp(s+n*l|0));default:return e}}clamp(t){return Math.min(255,t)}};L=C([O],L);var U={BOX_SINGLE_VERTICAL:179,BOX_DOUBLE_VERTICAL:186,BOX_DOUBLE_DOWN_AND_DOUBLE_LEFT:187,BOX_DOUBLE_UP_AND_DOUBLE_LEFT:188,BOX_SINGLE_DOWN_AND_SINGLE_LEFT:191,BOX_SINGLE_UP_AND_SINGLE_RIGHT:192,BOX_SINGLE_HORIZONTAL:196,BOX_DOUBLE_UP_AND_DOUBLE_RIGHT:200,BOX_DOUBLE_DOWN_AND_DOUBLE_RIGHT:201,BOX_DOUBLE_HORIZONTAL:205,BOX_SINGLE_UP_AND_SINGLE_LEFT:217,BOX_SINGLE_DOWN_AND_SINGLE_RIGHT:218,BLOCK_RIGHT_HALF:222,BLOCK_TOP_HALF:223},I={CENTER:"center",RIGHT:"right"},D=class{constructor(t,e,r,i,n){this.text=t,this.fg=e,this.bg=r,this.children=i,this.align=n}getWidth(){let t=0;if(this.text)for(let e of this.text.split(`
`))t=Math.max(t,e.length);if(this.children)for(let e of this.children)t=Math.max(t,e.getWidth());return t}getHeight(){let t=0;if(this.text&&(t+=this.text.split(`
`).length),this.children)for(let e of this.children)t+=e.getHeight();return t}};D=C([O],D);var F=class{constructor(t,e,r){this.width=t,this.height=e,this.grid=[],this.originX=0,this.originY=0,this.minX=0,this.maxX=0,this.minY=0,this.maxY=0,this.radius=0;for(let r=0;r<e;r++){let e=[];for(let i=0;i<t;i++)e.push(new L(i,r));this.grid.push(e)}if(this.clear(),r)for(let i=0;i<e;i++)for(let e=0;e<t;e++)this.grid[i][e].blocked=this.grid[i][e].blockedSight=r(e,i)}clear(){for(let t=0;t<this.height;t++)for(let e=0;e<this.width;e++)this.drawChar(e,t,0)}getCell(t,e){if(!(t<0||e<0||t>=this.width||e>=this.height))return this.grid[e][t]}getCharCode(t,e){if(!(t<0||e<0||t>=this.width||e>=this.height))return this.grid[e][t].charCode}drawChar(t,e,r,i,n){this.clip&&!this.clip.contains({x:t,y:e})||t>=0&&t<this.width&&e>=0&&e<this.height&&this.grid[0|e][0|t].setValue(r,i,n)}drawString(t,e,r,i,n){let J=r.split(`
`);for(let r=0;r<J.length;r++)this.drawStringLine(t,e+r,J[r],i,n)}drawStringLine(t,e,r,i,n){for(let J=0;J<r.length;J++)this.drawChar(t+J,e,r.charCodeAt(J),i,n)}drawCenteredString(t,e,r,i,n){this.drawString(t-Math.floor(r.length/2),e,r,i,n)}drawMessage(t,e,r,i){if(r.text){var n;let J;for(let o of(r.align===I.RIGHT?t+=i-r.text.length:r.align===I.CENTER&&(t+=i/2-r.text.length/2),n=r.text,J=RegExp("(\\S(.{0,"+(i||this.width-t)+"}\\S)?)\\s+","g"),(n+" ").replace(J,`$1
`).trim().split(`
`).map(t=>t.trim())))this.drawStringLine(t,e,o,r.fg,r.bg),e++}if(r.children)for(let n of r.children)e=this.drawMessage(t,e,n,i);return e}drawHLine(t,e,r,i,n,J){for(let o=t;o<t+r;o++)this.drawChar(o,e,i,n,J)}drawVLine(t,e,r,i,n,J){for(let o=e;o<e+r;o++)this.drawChar(t,o,i,n,J)}drawRect(t,e,r,i,n,J,o){this.drawHLine(t,e,r,n,J,o),this.drawHLine(t,e+i-1,r,n,J,o),this.drawVLine(t,e,i,n,J,o),this.drawVLine(t+r-1,e,i,n,J,o)}drawBox(t,e,r,i,n,J,o,s,a,h,l,u,c,f){this.drawHLine(t,e,r,n,c,f),this.drawHLine(t,e+i-1,r,o,c,f),this.drawVLine(t,e,i,s,c,f),this.drawVLine(t+r-1,e,i,J,c,f),this.drawChar(t,e,a,c,f),this.drawChar(t+r-1,e,h,c,f),this.drawChar(t,e+i-1,u,c,f),this.drawChar(t+r-1,e+i-1,l,c,f)}drawSingleBox(t,e,r,i,n,J){this.drawBox(t,e,r,i,U.BOX_SINGLE_HORIZONTAL,U.BOX_SINGLE_VERTICAL,U.BOX_SINGLE_HORIZONTAL,U.BOX_SINGLE_VERTICAL,U.BOX_SINGLE_DOWN_AND_SINGLE_RIGHT,U.BOX_SINGLE_DOWN_AND_SINGLE_LEFT,U.BOX_SINGLE_UP_AND_SINGLE_LEFT,U.BOX_SINGLE_UP_AND_SINGLE_RIGHT,n,J)}drawDoubleBox(t,e,r,i,n,J){this.drawBox(t,e,r,i,U.BOX_DOUBLE_HORIZONTAL,U.BOX_DOUBLE_VERTICAL,U.BOX_DOUBLE_HORIZONTAL,U.BOX_DOUBLE_VERTICAL,U.BOX_DOUBLE_DOWN_AND_DOUBLE_RIGHT,U.BOX_DOUBLE_DOWN_AND_DOUBLE_LEFT,U.BOX_DOUBLE_UP_AND_DOUBLE_LEFT,U.BOX_DOUBLE_UP_AND_DOUBLE_RIGHT,n,J)}fillRect(t,e,r,i,n,J,o){for(let s=e;s<e+i;s++)this.drawHLine(t,s,r,n,J,o)}drawConsole(t,e,r,i,n,J,o,s){for(let a=0;a<o;a++)for(let o=0;o<J;o++){let J=r.getCell(i+o,n+a);J&&this.drawCell(t+o,e+a,J,s)}}drawCell(t,e,r,i){t>=0&&t<this.width&&e>=0&&e<this.height&&this.grid[e][t].drawCell(r,i)}setBlocked(t,e,r){t>=0&&t<this.width&&e>=0&&e<this.height&&(this.grid[e][t].blocked=r)}setBlockedSight(t,e,r){t>=0&&t<this.width&&e>=0&&e<this.height&&(this.grid[e][t].blockedSight=r)}isVisible(t,e){return!(t<this.minX)&&!(t>this.maxX)&&!(e<this.minY)&&!(e>this.maxY)&&this.grid[e][t].visible}isBlocked(t,e){return t<0||t>this.width||e<0||e>this.height||this.grid[e][t].blocked}isBlockedSight(t,e){return t<0||t>this.width||e<0||e>this.height||this.grid[e][t].blockedSight}computeOctantY(t,e){let r=[],i=[],n=1,J=0,o=0,s=0,a,h,l,u,c,f,d,p,g,y;for(h=this.originY+e;h>=this.minY&&h<=this.maxY;h+=e,o=J,++n)for(l=.5/n,y=-1,u=Math.floor(s*n+.5),a=this.originX+u*t;u<=n&&a>=this.minX&&a<=this.maxX;a+=t,++u,y=g){if(c=!0,f=!1,d=u/n,p=y,g=d+l,o>0){if(this.grid[h-e][a].visible&&!this.grid[h-e][a].blockedSight||this.grid[h-e][a-t].visible&&!this.grid[h-e][a-t].blockedSight){for(let t=0;t<o&&c;++t)if(p<=i[t]&&g>=r[t]){if(this.grid[h][a].blockedSight){if(p>=r[t]&&g<=i[t]){c=!1;break}r[t]=Math.min(r[t],p),i[t]=Math.max(i[t],g),f=!0}else if(d>r[t]&&d<i[t]){c=!1;break}}}else c=!1}c&&(this.grid[h][a].visible=!0,this.grid[h][a].blockedSight&&(s>=p?s=g:f||(r[J]=p,i[J++]=g)))}}computeOctantX(t,e){let r=[],i=[],n=1,J=0,o=0,s=0,a,h,l,u,c,f,d,p,g,y;for(a=this.originX+t;a>=this.minX&&a<=this.maxX;a+=t,o=J,++n)for(l=.5/n,y=-1,u=Math.floor(s*n+.5),h=this.originY+u*e;u<=n&&h>=this.minY&&h<=this.maxY;h+=e,++u,y=g){if(c=!0,f=!1,d=u/n,p=y,g=d+l,o>0){if(this.grid[h][a-t].visible&&!this.grid[h][a-t].blockedSight||this.grid[h-e][a-t].visible&&!this.grid[h-e][a-t].blockedSight){for(let t=0;t<o&&c;++t)if(p<=i[t]&&g>=r[t]){if(this.grid[h][a].blockedSight){if(p>=r[t]&&g<=i[t]){c=!1;break}r[t]=Math.min(r[t],p),i[t]=Math.max(i[t],g),f=!0}else if(d>r[t]&&d<i[t]){c=!1;break}}}else c=!1}c&&(this.grid[h][a].visible=!0,this.grid[h][a].blockedSight&&(s>=p?s=g:f||(r[J]=p,i[J++]=g)))}}computeFov(t,e,r,i,n){if(this.originX=t,this.originY=e,this.radius=r,i)this.minX=Math.min(this.minX,Math.max(0,t-r)),this.minY=Math.min(this.minY,Math.max(0,e-r)),this.maxX=Math.max(this.maxX,Math.min(this.width-1,t+r)),this.maxY=Math.max(this.maxY,Math.min(this.height-1,e+r));else{this.minX=Math.max(0,t-r),this.minY=Math.max(0,e-r),this.maxX=Math.min(this.width-1,t+r),this.maxY=Math.min(this.height-1,e+r);for(let t=this.minY;t<=this.maxY;t++)for(let e=this.minX;e<=this.maxX;e++)this.grid[t][e].visible=!1}this.grid[e][t].visible=!0,void 0===n?(this.computeOctantY(1,1),this.computeOctantX(1,1),this.computeOctantX(1,-1),this.computeOctantY(1,-1),this.computeOctantY(-1,-1),this.computeOctantX(-1,-1),this.computeOctantX(-1,1),this.computeOctantY(-1,1)):(1&n&&this.computeOctantY(1,1),2&n&&this.computeOctantX(1,1),4&n&&this.computeOctantX(1,-1),8&n&&this.computeOctantY(1,-1),16&n&&this.computeOctantY(-1,-1),32&n&&this.computeOctantX(-1,-1),64&n&&this.computeOctantX(-1,1),128&n&&this.computeOctantY(-1,1))}updateExplored(){for(let t=this.minY;t<=this.maxY;t++)for(let e=this.minX;e<=this.maxX;e++){let r=this.grid[t][e];r.explored=r.explored||r.visible}}};F=C([O],F);var S=new class{constructor(t,e,r){this.url=t,this.charWidth=e,this.charHeight=r}}("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACAAQMAAAD58POIAAAABlBMVEUAAAD///+l2Z/dAAAEhklEQVRIx42Sv4oUQRDGC4UzadSwwMUD8QEKlbWD4Q58B/NGpTVocKO1wXHUzMAH0AcwMTYVGg5ag0IzEXaRjdZEZKNzkKbHqtnzHypY09M9+5uvqr7pbYCuC6ftaRhgONXs30eAh0O1rYDm4IS/eH0B8GxRW2vxo396yu/fb0ZFrW1zcOXlPU/XPwK8PGjbWhVwM4KnH61912oK4+zmmHJaQotyt1kvtC2Atdo24iohPDiG/v4eICJsY3Wy8Yvr0DSIBOdxgH6v8wsriWhc8s0AtaK/GzSl1jR0nSjQnwki6FQxNFKjgzO2a7BBqucH7dL4M9z96CIhT1Fs/AgKgcA6dKCxI29DaHNwRJ4EGAU1sU0OG9rmE4SIc3A4FChACqqhJRwpxkqh9wxag4DSmEJ5DtpFwAP4GUf6lmKcFFti1BYuQp4xN8kxM2kNhjdkTOiTUeAKGvhA1rLpMbYACQzCITlTDRMbLYoEa2JWPSMRFZIupcSzMVKcEUkX+sOG+ChNX2vD8ex6k7OFHL0P1655JuPd53WAD+yTv3UrCQiuHmYBbfIxpkImuvpBQBkVb5g4XHv3JkNireG8AO9zDhBZu2z2OMZ11S5/RIlyMefMNaZ4GsCz5xcjyM6hHYEjAYEfO8Ig1rklAe9sRIeYAdwyoIBq6YIzCAKiWoifA3m3o2AzWcdYKOdY47EIf8QABCuYgIUVmdVMEYEDA0Hmo/3D6KKJbh5mxhP3UsWIE97wnEygyizOfOLi2JOJW8CeOblW9IHeKZgv4zxuzDryOmb+4aQH+MXV6e0ywdUcxqCjBWl5GpbzZduOG1QEiGXP86T7EfiJfkMQ4OO4H0yqyNC2zlziWEN7Ywuc2fQ4p5BNkS5QYXP2h5NtRJh0vCKQidtVJmCGAwDSSQpYggSxiRIyzewsgCh4xxiTPDMh5aj//l7btqkr6rQyIOtLji4lVRQwXdzvus40Y53M33fh50GZwF4ExQeMlvuTggLzSi4ElKczUO7zVtpwdyMKdqZKOWb2nDblawPxPmuMwFEWBW+jlZR1eYtS442kiBGMWCi/h1/+GAR6NYOJWiqNJXFygFtrkx5C0O3IeFGs67HhEEhmBu/BUOT+0551pXxYIF+Elpi5AKRkLl5GUbCCZddyMv621ujEBPP4vSy2fotTx3U+d3WBiFOA6VSGSB49v/M7GBX9FPrDaT2c9qr4PCpwZ7qz813R94dVFIe19v33GlMZUghQFb8BrfE7QBmgBMbrn2B3enn/y3B5+DL8UBAdnejdYdBxeV9ejwoYNTgW0Ok/gA7UG2GAzanhL0DG7q4svynwF8UwDPu7u/vD0IudzSltMtVbP+J/gUbR29oJ7Fg9s6Uy+DnpiTCOYc4cXOeXMWfsusSw7FOg9x655nax6BlecwpOQQ68WBwp+H2LMQTuOq2RUigzh2Q/R3CWARJIJG199EwOTyKBlQMznshCRGeQ5gHABAQl6M4gLEdAzVaBWMCiANdsayDCHBA/hagKYfielrJIlipKKQIA9Nf3wBloTHT6BuAx15zRNa1nAAAAAElFTkSuQmCC",8,8),M=class{constructor(t,e){this.x=t,this.y=e}};M=C([O],M);var N=class{constructor(t,e,r,i){this.x=t,this.y=e,this.width=r,this.height=i}get left(){return this.x}get top(){return this.y}get x2(){return this.x+this.width}get y2(){return this.y+this.height}getCenter(){return new M(this.x+this.width/2|0,this.y+this.height/2|0)}intersects(t){return this.x<=t.x2&&this.x2>=t.x&&this.y<=t.y2&&this.y2>=t.y}contains(t){return t.x>=this.x&&t.x<this.x2&&t.y>=this.y&&t.y<this.y2}};N=C([O],N);var P=class{constructor(t,e,r){this.dialog=t,this.rect=e,this.contentsOffset=r,this.open=!1,this.count=0}},k=class{getState(t,e){let r=e.contentsRect.width+4,i=e.contentsRect.height+4,n=(t.width-r)/2|0,J=(t.height-i)/2|0;return new P(e,new N(n,J,r,i),new M(n+2,J+2))}draw(t,e){let r=e.dialog,{x:i,y:n,width:J,height:o}=e.rect;t.fillRect(i,n,J,o,0,T.WHITE,T.BLACK),t.drawSingleBox(i,n,J,o),t.drawCenteredString(i+J/2|0,n," "+r.title+" "),r.drawContents(t,e.contentsOffset)}},K=class{constructor(t,e=new k,r=[]){this.terminal=t,this.renderer=e,this.dialogs=r}add(t){this.dialogs.push(this.renderer.getState(this.terminal,t))}handleInput(){if(0===this.dialogs.length)return!1;let t=this.dialogs.length-1,e=this.dialogs[this.dialogs.length-1];return e.dialog.handleInput(this.terminal,e.contentsOffset)&&this.dialogs.splice(t,1),!0}draw(){for(let t=0;t<this.dialogs.length;t++)this.renderer.draw(this.terminal,this.dialogs[t])}},V=class{constructor(t,e){this.contentsRect=t,this.title=e}},j=class{constructor(){this.down=!1,this.downTime=0,this.repeat=!1,this.repeatTime=0,this.downCount=0,this.upCount=100}setDown(t){this.down!==t&&(this.down=t,this.repeat=!1,this.downTime=this.repeatTime=performance.now())}update(t){this.repeat=!1,this.down?(this.downCount++,this.upCount=0,t-this.downTime>=200&&t-this.repeatTime>=66.66666666666667&&(this.repeat=!0,this.repeatTime=t)):(this.downCount=0,this.upCount++)}isPressed(){return 1===this.downCount||this.repeat}isClicked(){return 1===this.upCount}},G=class{constructor(){this.inputs=new Map}clear(){this.inputs.clear()}get(t){let e=this.inputs.get(t);return e||(e=new j,this.inputs.set(t,e)),e}updateAll(t){this.inputs.forEach(e=>e.update(t))}},X=class{constructor(t){this.keys=new G,t.addEventListener("keydown",t=>this.setKey(t,!0)),t.addEventListener("keyup",t=>this.setKey(t,!1))}clear(){this.keys.clear()}getKey(t){return this.keys.get(t)}setKey(t,e){let r=t.code;r!==Y.VK_F11&&(t.stopPropagation(),t.preventDefault(),this.keys.get(r).setDown(e))}updateKeys(t){this.keys.updateAll(t)}},Y={VK_CONTROL_LEFT:"ControlLeft",VK_ESCAPE:"Escape",VK_PAGE_UP:"PageUp",VK_PAGE_DOWN:"PageDown",VK_END:"End",VK_HOME:"Home",VK_LEFT:"ArrowLeft",VK_UP:"ArrowUp",VK_RIGHT:"ArrowRight",VK_DOWN:"ArrowDown",VK_B:"KeyB",VK_H:"KeyH",VK_J:"KeyJ",VK_K:"KeyK",VK_L:"KeyL",VK_N:"KeyN",VK_U:"KeyU",VK_Y:"KeyY",VK_NUMPAD1:"Numpad1",VK_NUMPAD2:"Numpad2",VK_NUMPAD3:"Numpad3",VK_NUMPAD4:"Numpad4",VK_NUMPAD5:"Numpad5",VK_NUMPAD6:"Numpad6",VK_NUMPAD7:"Numpad7",VK_NUMPAD8:"Numpad8",VK_NUMPAD9:"Numpad9",VK_F11:"F11",VK_PERIOD:"Period"},H=class extends V{constructor(t,e){super(e instanceof D?new N(0,0,e.getWidth(),e.getHeight()):new N(0,0,e.length,1),t),this.message=e}drawContents(t,e){this.message instanceof D?t.drawMessage(e.x,e.y,this.message,this.message.getWidth()):t.drawString(e.x,e.y,this.message)}handleInput(t){return t.isKeyPressed(Y.VK_ESCAPE)}};U.BLOCK_TOP_HALF,U.BLOCK_RIGHT_HALF;var W=class{constructor(t){this.buttons=new G,this.el=t.canvas,this.width=t.width,this.height=t.height,this.prevX=0,this.prevY=0,this.x=0,this.y=0,this.dx=0,this.dy=0,this.wheelDeltaX=0,this.wheelDeltaY=0;let e=this.el;e.addEventListener("mousedown",t=>this.handleEvent(t)),e.addEventListener("mouseup",t=>this.handleEvent(t)),e.addEventListener("mousemove",t=>this.handleEvent(t)),e.addEventListener("contextmenu",t=>this.handleEvent(t)),e.addEventListener("touchstart",t=>this.handleTouchEvent(t)),e.addEventListener("touchend",t=>this.handleTouchEvent(t)),e.addEventListener("touchcancel",t=>this.handleTouchEvent(t)),e.addEventListener("touchmove",t=>this.handleTouchEvent(t)),e.addEventListener("wheel",t=>this.handleWheelEvent(t))}handleTouchEvent(t){if(t.stopPropagation(),t.preventDefault(),t.touches.length>0){let e=t.touches[0];this.updatePosition(e.clientX,e.clientY),this.buttons.get(0).setDown(!0)}else this.buttons.get(0).setDown(!1)}handleEvent(t){t.stopPropagation(),t.preventDefault(),this.updatePosition(t.clientX,t.clientY),"mousedown"===t.type&&(this.buttons.get(t.button).setDown(!0),this.el.focus()),"mouseup"===t.type&&this.buttons.get(t.button).setDown(!1)}handleWheelEvent(t){t.stopPropagation(),t.preventDefault(),this.wheelDeltaX=t.deltaX,this.wheelDeltaY=t.deltaY}updatePosition(t,e){let r=this.el.getBoundingClientRect(),i=this.width/this.height,n=r.width/r.height;if(n-i>.01){let t=i*r.height,e=r.width-t;r=new N(Math.floor(e/2),0,t,r.height)}if(n-i<-.01){let t=r.width/i,e=r.height-t;r=new N(0,Math.floor(e/2),r.width,t)}this.x=this.width*(t-r.left)/r.width|0,this.y=this.height*(e-r.top)/r.height|0}update(t){this.dx=this.x-this.prevX,this.dy=this.y-this.prevY,this.prevX=this.x,this.prevY=this.y,this.buttons.updateAll(t)}};B(0,0,0),B(255,255,255),B(136,0,0),B(170,255,238),B(204,68,204),B(0,204,85),B(0,0,170),B(238,238,119),B(221,136,85),B(102,68,0),B(255,119,119),B(51,51,51),B(119,119,119),B(170,255,102),B(0,136,255),B(187,187,187),B(0,0,0),B(255,255,255),B(136,0,0),B(170,255,238),B(204,68,204),B(0,204,85),B(0,0,170),B(238,238,119),B(221,136,85),B(102,68,0),B(255,119,119),B(51,51,51),B(119,119,119),B(170,255,102),B(0,136,255),B(187,187,187),B(0,0,0),B(29,43,83),B(126,37,83),B(0,135,81),B(171,82,54),B(95,87,79),B(194,195,199),B(255,241,232),B(255,0,77),B(255,163,0),B(255,236,39),B(0,228,54),B(41,173,255),B(131,118,156),B(255,119,168),B(255,204,170);var z=class{constructor(t=1){this.m=2147483648,this.a=1103515245,this.c=12345,this.state=t}nextInt(){return this.state=(this.a*this.state+this.c)%this.m,this.state}nextFloat(){return this.nextInt()/(this.m-1)}nextRange(t,e){let r=t+(this.nextInt()/this.m*(e-t)|0);if(isNaN(r))throw Error("rand nan");return r}chooseIndex(t){let e=t.reduce((t,e)=>t+e),r=this.nextRange(1,e+1),i=0;for(let e=0;e<t.length;e++)if(r<=(i+=t[e]))return e;return t.length-1}chooseKey(t){let e=Object.keys(t),r=e.map(e=>t[e]);return e[this.chooseIndex(r)]}};z=C([O],z);var $=`#version 300 es
precision highp float;in vec2 a;in vec2 b;in vec3 c;in vec3 d;out vec2 e;out vec4 f;out vec4 g;void main(void){gl_Position=vec4(a.x,a.y,0,1);e=b/16.0;f=vec4(c.r,c.g,c.b,1);g=vec4(d.r,d.g,d.b,1);}`,q=`#version 300 es
precision highp float;in vec2 e;in vec4 f;in vec4 g;uniform sampler2D s;out vec4 o;void main(void){o=texture(s,e);if(o.r<0.1) {o=g;} else {o=f;}}`,Q=`#version 300 es
precision highp float;
in vec2 a_position;
in vec2 a_texCoord;
out vec2 v_texCoord;
void main(void) {
  gl_Position=vec4(a_position.x, a_position.y, 0.0, 1.0);
  v_texCoord = a_texCoord;
}`,Z=`#version 300 es
#define PI 3.1415926535897932384626433832795
precision highp float;
in vec2 v_texCoord;
uniform sampler2D u_texture;
uniform float u_blur;
uniform float u_curvature;
uniform float u_chroma;
uniform float u_scanlineWidth;
uniform float u_scanlineIntensity;
uniform float u_vignette;
out vec4 outputColor;

vec2 curve(vec2 uv) {
  uv = (uv - 0.5) * 2.0;
  uv *= 1.1;
  uv.x *= 1.0 + pow((abs(uv.y) * u_curvature), 2.0);
  uv.y *= 1.0 + pow((abs(uv.x) * u_curvature), 2.0);
  uv /= 1.1;
  uv = (uv / 2.0) + 0.5;
  return uv;
}

void main() {
  vec2 iResolution = vec2(640.0, 360.0);
  vec2 q = v_texCoord;
  vec2 fragCoord = v_texCoord;
  vec2 uv = q;
  uv = curve(uv);

  // Outside of range is black
  if (uv.x < 0.0 || uv.x > 1.0 || uv.y < 0.0 || uv.y > 1.0) {
    outputColor = vec4(0.0, 0.0, 0.0, 1.0);
    return;
  }

  vec4 col;

  // Chromatic aberration
  // col = texture(u_texture, uv.xy);
  col.r = 0.7 * texture(u_texture, vec2(uv.x + 0.001 * u_chroma, uv.y + 0.001 * u_chroma)).r;
  col.g = 0.7 * texture(u_texture, vec2(uv.x + 0.000 * u_chroma, uv.y - 0.002 * u_chroma)).g;
  col.b = 0.7 * texture(u_texture, vec2(uv.x - 0.002 * u_chroma, uv.y + 0.000 * u_chroma)).b;
  
  // Blur
  col += 0.05 * texture(u_texture, vec2(uv.x - 2.0 * u_blur / iResolution.x, uv.y));
  col += 0.10 * texture(u_texture, vec2(uv.x - 1.0 * u_blur / iResolution.x, uv.y));
  col += 0.10 * texture(u_texture, vec2(uv.x + 1.0 * u_blur / iResolution.x, uv.y));
  col += 0.05 * texture(u_texture, vec2(uv.x + 2.0 * u_blur / iResolution.x, uv.y));

  // Vignette
  col *= pow(16.0 * uv.x * uv.y * (1.0 - uv.x) * (1.0 - uv.y), u_vignette);

  // Scanlines
  col *= clamp(1.0 + u_scanlineWidth * sin(uv.y * iResolution.y * 2.0 * PI), 1.0 - u_scanlineIntensity, 1.0);

  outputColor = vec4(col.rgb, 1.0);
}`;function tt(t,e){return -1+t/e*2}var te={[Y.VK_K]:new M(0,-1),[Y.VK_UP]:new M(0,-1),[Y.VK_NUMPAD8]:new M(0,-1),[Y.VK_J]:new M(0,1),[Y.VK_DOWN]:new M(0,1),[Y.VK_NUMPAD2]:new M(0,1),[Y.VK_H]:new M(-1,0),[Y.VK_LEFT]:new M(-1,0),[Y.VK_NUMPAD4]:new M(-1,0),[Y.VK_L]:new M(1,0),[Y.VK_RIGHT]:new M(1,0),[Y.VK_NUMPAD6]:new M(1,0),[Y.VK_Y]:new M(-1,-1),[Y.VK_NUMPAD7]:new M(-1,-1),[Y.VK_U]:new M(1,-1),[Y.VK_NUMPAD9]:new M(1,-1),[Y.VK_B]:new M(-1,1),[Y.VK_NUMPAD1]:new M(-1,1),[Y.VK_N]:new M(1,1),[Y.VK_NUMPAD3]:new M(1,1),[Y.VK_PERIOD]:new M(0,0),[Y.VK_NUMPAD5]:new M(0,0)},tr={font:S,movementKeys:te},ti=class extends F{constructor(t,e,r,i=tr){super(e,r),this.canvas=t,this.font=i.font??S,this.crt=i.crt,this.maxFps=i.maxFps,this.pixelWidth=e*this.font.charWidth,this.pixelHeight=r*this.font.charHeight,this.pixelScale=i.crt?.scale??1,t.width=this.pixelWidth*this.pixelScale,t.height=this.pixelHeight*this.pixelScale,t.style.imageRendering="pixelated",t.style.outline="none",t.tabIndex=0,this.handleResize(),window.addEventListener("resize",()=>this.handleResize()),this.keys=new X(t),this.mouse=new W(this);let n=t.getContext("webgl2",{antialias:!1});if(!n)throw Error("Unable to initialize WebGL. Your browser may not support it.");let J=n.createProgram();if(!J)throw Error("Unable to initialize WebGL. Your browser may not support it.");this.gl=n,this.program=J,n.attachShader(J,this.buildShader(n.VERTEX_SHADER,$)),n.attachShader(J,this.buildShader(n.FRAGMENT_SHADER,q)),n.linkProgram(J),n.useProgram(J),this.crtProgram=n.createProgram(),n.attachShader(this.crtProgram,this.buildShader(n.VERTEX_SHADER,Q)),n.attachShader(this.crtProgram,this.buildShader(n.FRAGMENT_SHADER,Z)),n.linkProgram(this.crtProgram),n.useProgram(this.crtProgram),this.crtBlurLocation=n.getUniformLocation(this.crtProgram,"u_blur"),this.crtCurvatureLocation=n.getUniformLocation(this.crtProgram,"u_curvature"),this.crtChromaLocation=n.getUniformLocation(this.crtProgram,"u_chroma"),this.crtScanlineWidthLocation=n.getUniformLocation(this.crtProgram,"u_scanlineWidth"),this.crtScanlineIntensityLocation=n.getUniformLocation(this.crtProgram,"u_scanlineIntensity"),this.crtVignetteLocation=n.getUniformLocation(this.crtProgram,"u_vignette"),this.crtPositionLocation=n.getAttribLocation(this.crtProgram,"a_position"),this.crtPositionBuffer=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,this.crtPositionBuffer),n.bufferData(n.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),n.STATIC_DRAW),n.enableVertexAttribArray(this.crtPositionLocation),n.vertexAttribPointer(this.crtPositionLocation,2,n.FLOAT,!1,0,0),this.crtTexCoordLocation=n.getAttribLocation(this.crtProgram,"a_texCoord"),this.crtTexCoordBuffer=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,this.crtTexCoordBuffer),n.bufferData(n.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),n.STATIC_DRAW),n.enableVertexAttribArray(this.crtTexCoordLocation),n.vertexAttribPointer(this.crtTexCoordLocation,2,n.FLOAT,!1,0,0),this.positionAttribLocation=this.getAttribLocation("a"),this.textureAttribLocation=this.getAttribLocation("b"),this.fgColorAttribLocation=this.getAttribLocation("c"),this.bgColorAttribLocation=this.getAttribLocation("d");let o=e*r;this.positionsArray=new Float32Array(12*o),this.indexArray=new Uint16Array(6*o),this.textureArray=new Float32Array(8*o),this.foregroundUint8Array=new Uint8Array(16*o),this.foregroundDataView=new DataView(this.foregroundUint8Array.buffer),this.backgroundUint8Array=new Uint8Array(16*o),this.backgroundDataView=new DataView(this.backgroundUint8Array.buffer),this.frameBufferTexture=n.createTexture(),n.bindTexture(n.TEXTURE_2D,this.frameBufferTexture),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,this.pixelWidth,this.pixelHeight,0,n.RGBA,n.UNSIGNED_BYTE,null),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),this.frameBuffer=n.createFramebuffer(),n.bindFramebuffer(n.FRAMEBUFFER,this.frameBuffer),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,this.frameBufferTexture,0);let s=0,a=0,h=0;for(let t=0;t<r;t++)for(let i=0;i<e;i++)this.positionsArray[s++]=tt(i,e),this.positionsArray[s++]=-tt(t,r),this.positionsArray[s++]=tt(i+1,e),this.positionsArray[s++]=-tt(t,r),this.positionsArray[s++]=tt(i+1,e),this.positionsArray[s++]=-tt(t+1,r),this.positionsArray[s++]=tt(i,e),this.positionsArray[s++]=-tt(t+1,r),this.indexArray[a++]=h+0,this.indexArray[a++]=h+1,this.indexArray[a++]=h+2,this.indexArray[a++]=h+0,this.indexArray[a++]=h+2,this.indexArray[a++]=h+3,h+=4;this.positionBuffer=n.createBuffer(),this.indexBuffer=n.createBuffer(),this.textureBuffer=n.createBuffer(),this.foregroundBuffer=n.createBuffer(),this.backgroundBuffer=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,this.positionBuffer),n.bufferData(n.ARRAY_BUFFER,this.positionsArray,n.STATIC_DRAW),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,this.indexArray,n.STATIC_DRAW),this.texture=this.loadTexture(this.font.url),this.lastRenderTime=0,this.renderDelta=0,this.fps=0,this.averageFps=0,void 0===this.maxFps?this.requestAnimationFrame():window.setInterval(()=>this.renderLoop(performance.now()),1e3/this.maxFps)}handleResize(){let t=this.canvas.parentElement;if(!t)return;let e=Math.min(t.offsetWidth/this.pixelWidth,t.offsetHeight/this.pixelHeight),r=e*this.pixelWidth|0,i=e*this.pixelHeight|0;this.canvas.style.width=r+"px",this.canvas.style.height=i+"px"}getAttribLocation(t){let e=this.gl.getAttribLocation(this.program,t);return this.gl.enableVertexAttribArray(e),e}flush(){let t=0,e=0;for(let r=0;r<this.height;r++)for(let i=0;i<this.width;i++){let n=this.getCell(i,r);if(!n.dirty){t+=8,e+=16;continue}let J=n.charCode%16,o=n.charCode/16|0;this.textureArray[t++]=J,this.textureArray[t++]=o,this.textureArray[t++]=J+1,this.textureArray[t++]=o,this.textureArray[t++]=J+1,this.textureArray[t++]=o+1,this.textureArray[t++]=J,this.textureArray[t++]=o+1;for(let t=0;t<4;t++)this.foregroundDataView.setUint32(e,n.fg,!1),this.backgroundDataView.setUint32(e,n.bg,!1),e+=4;n.dirty=!1}}isKeyDown(t){return this.keys.getKey(t).down}isKeyPressed(t){return this.keys.getKey(t).isPressed()}getKeyDownCount(t){return this.keys.getKey(t).downCount}getMovementKey(t=te){for(let[e,r]of Object.entries(t))if(this.isKeyPressed(e))return r}buildShader(t,e){let r=this.gl,i=r.createShader(t);if(!i)throw Error("An error occurred compiling the shader: ");if(r.shaderSource(i,e),r.compileShader(i),!r.getShaderParameter(i,r.COMPILE_STATUS))throw Error("An error occurred compiling the shader: "+r.getShaderInfoLog(i));return i}loadTexture(t){let e=this.gl,r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r);let i=e.RGBA,n=e.RGBA,J=e.UNSIGNED_BYTE,o=new Uint8Array([0,0,0,255]);e.texImage2D(e.TEXTURE_2D,0,i,1,1,0,n,J,o);let s=new Image;return s.onload=()=>{e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,i,n,J,s),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST)},s.src=t,r}render(){let t=this.gl;t.clearColor(0,0,0,1),t.clearDepth(1),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),this.crt?t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer):t.bindFramebuffer(t.FRAMEBUFFER,null),t.viewport(0,0,this.pixelWidth,this.pixelHeight);{let e=t.FLOAT;t.bindBuffer(t.ARRAY_BUFFER,this.positionBuffer),t.vertexAttribPointer(this.positionAttribLocation,2,e,!1,0,0)}{let e=t.FLOAT;t.bindBuffer(t.ARRAY_BUFFER,this.textureBuffer),t.bufferData(t.ARRAY_BUFFER,this.textureArray,t.DYNAMIC_DRAW),t.vertexAttribPointer(this.textureAttribLocation,2,e,!1,0,0)}{let e=t.UNSIGNED_BYTE;t.bindBuffer(t.ARRAY_BUFFER,this.foregroundBuffer),t.bufferData(t.ARRAY_BUFFER,this.foregroundUint8Array,t.DYNAMIC_DRAW),t.vertexAttribPointer(this.fgColorAttribLocation,4,e,!0,0,0)}{let e=t.UNSIGNED_BYTE;t.bindBuffer(t.ARRAY_BUFFER,this.backgroundBuffer),t.bufferData(t.ARRAY_BUFFER,this.backgroundUint8Array,t.DYNAMIC_DRAW),t.vertexAttribPointer(this.bgColorAttribLocation,4,e,!0,0,0)}t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.useProgram(this.program),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this.texture);{let e=this.width*this.height*6,r=t.UNSIGNED_SHORT;t.drawElements(t.TRIANGLES,e,r,0)}}renderCrt(){let t=this.crt;if(!t)return;let e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,null),e.viewport(0,0,this.pixelWidth*this.pixelScale,this.pixelHeight*this.pixelScale),e.useProgram(this.crtProgram),e.uniform1f(this.crtBlurLocation,t.blur),e.uniform1f(this.crtCurvatureLocation,t.curvature),e.uniform1f(this.crtChromaLocation,t.chroma),e.uniform1f(this.crtVignetteLocation,t.vignette),e.uniform1f(this.crtScanlineWidthLocation,t.scanlineWidth),e.uniform1f(this.crtScanlineIntensityLocation,t.scanlineIntensity),e.bindBuffer(e.ARRAY_BUFFER,this.crtPositionBuffer),e.vertexAttribPointer(this.crtPositionLocation,2,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,this.crtTexCoordBuffer),e.vertexAttribPointer(this.crtTexCoordLocation,2,e.FLOAT,!1,0,0),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this.frameBufferTexture),e.drawArrays(e.TRIANGLES,0,6)}requestAnimationFrame(){window.requestAnimationFrame(t=>this.renderLoop(t))}renderLoop(t){0===this.lastRenderTime?(this.lastRenderTime=t,this.fps=0):(this.renderDelta=t-this.lastRenderTime,this.lastRenderTime=t,this.fps=1e3/this.renderDelta,this.averageFps=.95*this.averageFps+.05*this.fps),this.keys.updateKeys(t),this.mouse.update(t),this.update&&this.update(),this.flush(),this.render(),this.crt&&this.renderCrt(),void 0===this.maxFps&&this.requestAnimationFrame()}},l=a("dfbYt"),tn={};t=function(t){var e,r,i=function(t){var e=t.length;if(e%4>0)throw Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("=");-1===r&&(r=e);var i=r===e?0:4-r%4;return[r,i]}(t),n=i[0],J=i[1],o=new ts((n+J)*3/4-J),s=0,a=J>0?n-4:n;for(r=0;r<a;r+=4)e=to[t.charCodeAt(r)]<<18|to[t.charCodeAt(r+1)]<<12|to[t.charCodeAt(r+2)]<<6|to[t.charCodeAt(r+3)],o[s++]=e>>16&255,o[s++]=e>>8&255,o[s++]=255&e;return 2===J&&(e=to[t.charCodeAt(r)]<<2|to[t.charCodeAt(r+1)]>>4,o[s++]=255&e),1===J&&(e=to[t.charCodeAt(r)]<<10|to[t.charCodeAt(r+1)]<<4|to[t.charCodeAt(r+2)]>>2,o[s++]=e>>8&255,o[s++]=255&e),o},e=function(t){for(var e,r=t.length,i=r%3,n=[],J=0,o=r-i;J<o;J+=16383)n.push(function(t,e,r){for(var i,n=[],J=e;J<r;J+=3)n.push(tJ[(i=(t[J]<<16&16711680)+(t[J+1]<<8&65280)+(255&t[J+2]))>>18&63]+tJ[i>>12&63]+tJ[i>>6&63]+tJ[63&i]);return n.join("")}(t,J,J+16383>o?o:J+16383));return 1===i?n.push(tJ[(e=t[r-1])>>2]+tJ[e<<4&63]+"=="):2===i&&n.push(tJ[(e=(t[r-2]<<8)+t[r-1])>>10]+tJ[e>>4&63]+tJ[e<<2&63]+"="),n.join("")};for(var tJ=[],to=[],ts="undefined"!=typeof Uint8Array?Uint8Array:Array,ta="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",th=0,tl=ta.length;th<tl;++th)tJ[th]=ta[th],to[ta.charCodeAt(th)]=th;to["-".charCodeAt(0)]=62,to["_".charCodeAt(0)]=63,r=function(t,e,r,i,n){var J,o,s=8*n-i-1,a=(1<<s)-1,h=a>>1,l=-7,u=r?n-1:0,c=r?-1:1,f=t[e+u];for(u+=c,J=f&(1<<-l)-1,f>>=-l,l+=s;l>0;J=256*J+t[e+u],u+=c,l-=8);for(o=J&(1<<-l)-1,J>>=-l,l+=i;l>0;o=256*o+t[e+u],u+=c,l-=8);if(0===J)J=1-h;else{if(J===a)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,i),J-=h}return(f?-1:1)*o*Math.pow(2,J-i)},i=function(t,e,r,i,n,J){var o,s,a,h=8*J-n-1,l=(1<<h)-1,u=l>>1,c=23===n?5960464477539062e-23:0,f=i?0:J-1,d=i?1:-1,p=e<0||0===e&&1/e<0?1:0;for(isNaN(e=Math.abs(e))||e===1/0?(s=isNaN(e)?1:0,o=l):(o=Math.floor(Math.log(e)/Math.LN2),e*(a=Math.pow(2,-o))<1&&(o--,a*=2),o+u>=1?e+=c/a:e+=c*Math.pow(2,1-u),e*a>=2&&(o++,a/=2),o+u>=l?(s=0,o=l):o+u>=1?(s=(e*a-1)*Math.pow(2,n),o+=u):(s=e*Math.pow(2,u-1)*Math.pow(2,n),o=0));n>=8;t[r+f]=255&s,f+=d,s/=256,n-=8);for(o=o<<n|s,h+=n;h>0;t[r+f]=255&o,f+=d,o/=256,h-=8);t[r+f-d]|=128*p};let tu="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;function tc(t){if(t>2147483647)throw RangeError('The value "'+t+'" is invalid for option "size"');let e=new Uint8Array(t);return Object.setPrototypeOf(e,tf.prototype),e}function tf(t,e,r){if("number"==typeof t){if("string"==typeof e)throw TypeError('The "string" argument must be of type string. Received type number');return tg(t)}return td(t,e,r)}function td(t,e,r){if("string"==typeof t)return function(t,e){if(("string"!=typeof e||""===e)&&(e="utf8"),!tf.isEncoding(e))throw TypeError("Unknown encoding: "+e);let r=0|tb(t,e),i=tc(r),n=i.write(t,e);return n!==r&&(i=i.slice(0,n)),i}(t,e);if(ArrayBuffer.isView(t))return function(t){if(tj(t,Uint8Array)){let e=new Uint8Array(t);return tm(e.buffer,e.byteOffset,e.byteLength)}return ty(t)}(t);if(null==t)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t);if(tj(t,ArrayBuffer)||t&&tj(t.buffer,ArrayBuffer)||"undefined"!=typeof SharedArrayBuffer&&(tj(t,SharedArrayBuffer)||t&&tj(t.buffer,SharedArrayBuffer)))return tm(t,e,r);if("number"==typeof t)throw TypeError('The "value" argument must not be of type number. Received type number');let i=t.valueOf&&t.valueOf();if(null!=i&&i!==t)return tf.from(i,e,r);let n=function(t){var e;if(tf.isBuffer(t)){let e=0|tw(t.length),r=tc(e);return 0===r.length||t.copy(r,0,0,e),r}return void 0!==t.length?"number"!=typeof t.length||(e=t.length)!=e?tc(0):ty(t):"Buffer"===t.type&&Array.isArray(t.data)?ty(t.data):void 0}(t);if(n)return n;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof t[Symbol.toPrimitive])return tf.from(t[Symbol.toPrimitive]("string"),e,r);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t)}function tp(t){if("number"!=typeof t)throw TypeError('"size" argument must be of type number');if(t<0)throw RangeError('The value "'+t+'" is invalid for option "size"')}function tg(t){return tp(t),tc(t<0?0:0|tw(t))}function ty(t){let e=t.length<0?0:0|tw(t.length),r=tc(e);for(let i=0;i<e;i+=1)r[i]=255&t[i];return r}function tm(t,e,r){let i;if(e<0||t.byteLength<e)throw RangeError('"offset" is outside of buffer bounds');if(t.byteLength<e+(r||0))throw RangeError('"length" is outside of buffer bounds');return Object.setPrototypeOf(i=void 0===e&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,e):new Uint8Array(t,e,r),tf.prototype),i}function tw(t){if(t>=2147483647)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|t}function tb(t,e){if(tf.isBuffer(t))return t.length;if(ArrayBuffer.isView(t)||tj(t,ArrayBuffer))return t.byteLength;if("string"!=typeof t)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof t);let r=t.length,i=arguments.length>2&&!0===arguments[2];if(!i&&0===r)return 0;let n=!1;for(;;)switch(e){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return tk(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return tK(t).length;default:if(n)return i?-1:tk(t).length;e=(""+e).toLowerCase(),n=!0}}function tv(t,r,i){let n=!1;if((void 0===r||r<0)&&(r=0),r>this.length||((void 0===i||i>this.length)&&(i=this.length),i<=0||(i>>>=0)<=(r>>>=0)))return"";for(t||(t="utf8");;)switch(t){case"hex":return function(t,e,r){let i=t.length;(!e||e<0)&&(e=0),(!r||r<0||r>i)&&(r=i);let n="";for(let i=e;i<r;++i)n+=tG[t[i]];return n}(this,r,i);case"utf8":case"utf-8":return tx(this,r,i);case"ascii":return function(t,e,r){let i="";r=Math.min(t.length,r);for(let n=e;n<r;++n)i+=String.fromCharCode(127&t[n]);return i}(this,r,i);case"latin1":case"binary":return function(t,e,r){let i="";r=Math.min(t.length,r);for(let n=e;n<r;++n)i+=String.fromCharCode(t[n]);return i}(this,r,i);case"base64":var J,o;return J=r,o=i,0===J&&o===this.length?e(this):e(this.slice(J,o));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(t,e,r){let i=t.slice(e,r),n="";for(let t=0;t<i.length-1;t+=2)n+=String.fromCharCode(i[t]+256*i[t+1]);return n}(this,r,i);default:if(n)throw TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0}}function t_(t,e,r){let i=t[e];t[e]=t[r],t[r]=i}function tA(t,e,r,i,n){var J;if(0===t.length)return -1;if("string"==typeof r?(i=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),(J=r=+r)!=J&&(r=n?0:t.length-1),r<0&&(r=t.length+r),r>=t.length){if(n)return -1;r=t.length-1}else if(r<0){if(!n)return -1;r=0}if("string"==typeof e&&(e=tf.from(e,i)),tf.isBuffer(e))return 0===e.length?-1:tE(t,e,r,i,n);if("number"==typeof e)return(e&=255,"function"==typeof Uint8Array.prototype.indexOf)?n?Uint8Array.prototype.indexOf.call(t,e,r):Uint8Array.prototype.lastIndexOf.call(t,e,r):tE(t,[e],r,i,n);throw TypeError("val must be string, number or Buffer")}function tE(t,e,r,i,n){let J,o=1,s=t.length,a=e.length;if(void 0!==i&&("ucs2"===(i=String(i).toLowerCase())||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(t.length<2||e.length<2)return -1;o=2,s/=2,a/=2,r/=2}function h(t,e){return 1===o?t[e]:t.readUInt16BE(e*o)}if(n){let i=-1;for(J=r;J<s;J++)if(h(t,J)===h(e,-1===i?0:J-i)){if(-1===i&&(i=J),J-i+1===a)return i*o}else -1!==i&&(J-=J-i),i=-1}else for(r+a>s&&(r=s-a),J=r;J>=0;J--){let r=!0;for(let i=0;i<a;i++)if(h(t,J+i)!==h(e,i)){r=!1;break}if(r)return J}return -1}function tx(t,e,r){r=Math.min(t.length,r);let i=[],n=e;for(;n<r;){let e=t[n],J=null,o=e>239?4:e>223?3:e>191?2:1;if(n+o<=r){let r,i,s,a;switch(o){case 1:e<128&&(J=e);break;case 2:(192&(r=t[n+1]))==128&&(a=(31&e)<<6|63&r)>127&&(J=a);break;case 3:r=t[n+1],i=t[n+2],(192&r)==128&&(192&i)==128&&(a=(15&e)<<12|(63&r)<<6|63&i)>2047&&(a<55296||a>57343)&&(J=a);break;case 4:r=t[n+1],i=t[n+2],s=t[n+3],(192&r)==128&&(192&i)==128&&(192&s)==128&&(a=(15&e)<<18|(63&r)<<12|(63&i)<<6|63&s)>65535&&a<1114112&&(J=a)}}null===J?(J=65533,o=1):J>65535&&(J-=65536,i.push(J>>>10&1023|55296),J=56320|1023&J),i.push(J),n+=o}return function(t){let e=t.length;if(e<=4096)return String.fromCharCode.apply(String,t);let r="",i=0;for(;i<e;)r+=String.fromCharCode.apply(String,t.slice(i,i+=4096));return r}(i)}function tC(t,e,r){if(t%1!=0||t<0)throw RangeError("offset is not uint");if(t+e>r)throw RangeError("Trying to access beyond buffer length")}function tB(t,e,r,i,n,J){if(!tf.isBuffer(t))throw TypeError('"buffer" argument must be a Buffer instance');if(e>n||e<J)throw RangeError('"value" argument is out of bounds');if(r+i>t.length)throw RangeError("Index out of range")}function tT(t,e,r,i,n){tS(e,i,n,t,r,7);let J=Number(e&BigInt(4294967295));t[r++]=J,J>>=8,t[r++]=J,J>>=8,t[r++]=J,J>>=8,t[r++]=J;let o=Number(e>>BigInt(32)&BigInt(4294967295));return t[r++]=o,o>>=8,t[r++]=o,o>>=8,t[r++]=o,o>>=8,t[r++]=o,r}function tR(t,e,r,i,n){tS(e,i,n,t,r,7);let J=Number(e&BigInt(4294967295));t[r+7]=J,J>>=8,t[r+6]=J,J>>=8,t[r+5]=J,J>>=8,t[r+4]=J;let o=Number(e>>BigInt(32)&BigInt(4294967295));return t[r+3]=o,o>>=8,t[r+2]=o,o>>=8,t[r+1]=o,o>>=8,t[r]=o,r+8}function tO(t,e,r,i,n,J){if(r+i>t.length||r<0)throw RangeError("Index out of range")}function tL(t,e,r,n,J){return e=+e,r>>>=0,J||tO(t,e,r,4,34028234663852886e22,-34028234663852886e22),i(t,e,r,n,23,4),r+4}function tU(t,e,r,n,J){return e=+e,r>>>=0,J||tO(t,e,r,8,17976931348623157e292,-17976931348623157e292),i(t,e,r,n,52,8),r+8}tf.TYPED_ARRAY_SUPPORT=function(){try{let t=new Uint8Array(1),e={foo:function(){return 42}};return Object.setPrototypeOf(e,Uint8Array.prototype),Object.setPrototypeOf(t,e),42===t.foo()}catch(t){return!1}}(),tf.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(tf.prototype,"parent",{enumerable:!0,get:function(){if(tf.isBuffer(this))return this.buffer}}),Object.defineProperty(tf.prototype,"offset",{enumerable:!0,get:function(){if(tf.isBuffer(this))return this.byteOffset}}),tf.poolSize=8192,tf.from=function(t,e,r){return td(t,e,r)},Object.setPrototypeOf(tf.prototype,Uint8Array.prototype),Object.setPrototypeOf(tf,Uint8Array),tf.alloc=function(t,e,r){return(tp(t),t<=0)?tc(t):void 0!==e?"string"==typeof r?tc(t).fill(e,r):tc(t).fill(e):tc(t)},tf.allocUnsafe=function(t){return tg(t)},tf.allocUnsafeSlow=function(t){return tg(t)},tf.isBuffer=function(t){return null!=t&&!0===t._isBuffer&&t!==tf.prototype},tf.compare=function(t,e){if(tj(t,Uint8Array)&&(t=tf.from(t,t.offset,t.byteLength)),tj(e,Uint8Array)&&(e=tf.from(e,e.offset,e.byteLength)),!tf.isBuffer(t)||!tf.isBuffer(e))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(t===e)return 0;let r=t.length,i=e.length;for(let n=0,J=Math.min(r,i);n<J;++n)if(t[n]!==e[n]){r=t[n],i=e[n];break}return r<i?-1:i<r?1:0},tf.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},tf.concat=function(t,e){let r;if(!Array.isArray(t))throw TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return tf.alloc(0);if(void 0===e)for(r=0,e=0;r<t.length;++r)e+=t[r].length;let i=tf.allocUnsafe(e),n=0;for(r=0;r<t.length;++r){let e=t[r];if(tj(e,Uint8Array))n+e.length>i.length?(tf.isBuffer(e)||(e=tf.from(e)),e.copy(i,n)):Uint8Array.prototype.set.call(i,e,n);else if(tf.isBuffer(e))e.copy(i,n);else throw TypeError('"list" argument must be an Array of Buffers');n+=e.length}return i},tf.byteLength=tb,tf.prototype._isBuffer=!0,tf.prototype.swap16=function(){let t=this.length;if(t%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(let e=0;e<t;e+=2)t_(this,e,e+1);return this},tf.prototype.swap32=function(){let t=this.length;if(t%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(let e=0;e<t;e+=4)t_(this,e,e+3),t_(this,e+1,e+2);return this},tf.prototype.swap64=function(){let t=this.length;if(t%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(let e=0;e<t;e+=8)t_(this,e,e+7),t_(this,e+1,e+6),t_(this,e+2,e+5),t_(this,e+3,e+4);return this},tf.prototype.toString=function(){let t=this.length;return 0===t?"":0==arguments.length?tx(this,0,t):tv.apply(this,arguments)},tf.prototype.toLocaleString=tf.prototype.toString,tf.prototype.equals=function(t){if(!tf.isBuffer(t))throw TypeError("Argument must be a Buffer");return this===t||0===tf.compare(this,t)},tf.prototype.inspect=function(){let t="";return t=this.toString("hex",0,50).replace(/(.{2})/g,"$1 ").trim(),this.length>50&&(t+=" ... "),"<Buffer "+t+">"},tu&&(tf.prototype[tu]=tf.prototype.inspect),tf.prototype.compare=function(t,e,r,i,n){if(tj(t,Uint8Array)&&(t=tf.from(t,t.offset,t.byteLength)),!tf.isBuffer(t))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof t);if(void 0===e&&(e=0),void 0===r&&(r=t?t.length:0),void 0===i&&(i=0),void 0===n&&(n=this.length),e<0||r>t.length||i<0||n>this.length)throw RangeError("out of range index");if(i>=n&&e>=r)return 0;if(i>=n)return -1;if(e>=r)return 1;if(e>>>=0,r>>>=0,i>>>=0,n>>>=0,this===t)return 0;let J=n-i,o=r-e,s=Math.min(J,o),a=this.slice(i,n),h=t.slice(e,r);for(let t=0;t<s;++t)if(a[t]!==h[t]){J=a[t],o=h[t];break}return J<o?-1:o<J?1:0},tf.prototype.includes=function(t,e,r){return -1!==this.indexOf(t,e,r)},tf.prototype.indexOf=function(t,e,r){return tA(this,t,e,r,!0)},tf.prototype.lastIndexOf=function(t,e,r){return tA(this,t,e,r,!1)},tf.prototype.write=function(t,e,r,i){var n,J,o,s,a,h,l,u;if(void 0===e)i="utf8",r=this.length,e=0;else if(void 0===r&&"string"==typeof e)i=e,r=this.length,e=0;else if(isFinite(e))e>>>=0,isFinite(r)?(r>>>=0,void 0===i&&(i="utf8")):(i=r,r=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");let c=this.length-e;if((void 0===r||r>c)&&(r=c),t.length>0&&(r<0||e<0)||e>this.length)throw RangeError("Attempt to write outside buffer bounds");i||(i="utf8");let f=!1;for(;;)switch(i){case"hex":return function(t,e,r,i){let n;r=Number(r)||0;let J=t.length-r;i?(i=Number(i))>J&&(i=J):i=J;let o=e.length;for(i>o/2&&(i=o/2),n=0;n<i;++n){let i=parseInt(e.substr(2*n,2),16);if(i!=i)break;t[r+n]=i}return n}(this,t,e,r);case"utf8":case"utf-8":return n=e,J=r,tV(tk(t,this.length-n),this,n,J);case"ascii":case"latin1":case"binary":return o=e,s=r,tV(function(t){let e=[];for(let r=0;r<t.length;++r)e.push(255&t.charCodeAt(r));return e}(t),this,o,s);case"base64":return a=e,h=r,tV(tK(t),this,a,h);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return l=e,u=r,tV(function(t,e){let r,i;let n=[];for(let J=0;J<t.length&&!((e-=2)<0);++J)i=(r=t.charCodeAt(J))>>8,n.push(r%256),n.push(i);return n}(t,this.length-l),this,l,u);default:if(f)throw TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),f=!0}},tf.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},tf.prototype.slice=function(t,e){let r=this.length;t=~~t,e=void 0===e?r:~~e,t<0?(t+=r)<0&&(t=0):t>r&&(t=r),e<0?(e+=r)<0&&(e=0):e>r&&(e=r),e<t&&(e=t);let i=this.subarray(t,e);return Object.setPrototypeOf(i,tf.prototype),i},tf.prototype.readUintLE=tf.prototype.readUIntLE=function(t,e,r){t>>>=0,e>>>=0,r||tC(t,e,this.length);let i=this[t],n=1,J=0;for(;++J<e&&(n*=256);)i+=this[t+J]*n;return i},tf.prototype.readUintBE=tf.prototype.readUIntBE=function(t,e,r){t>>>=0,e>>>=0,r||tC(t,e,this.length);let i=this[t+--e],n=1;for(;e>0&&(n*=256);)i+=this[t+--e]*n;return i},tf.prototype.readUint8=tf.prototype.readUInt8=function(t,e){return t>>>=0,e||tC(t,1,this.length),this[t]},tf.prototype.readUint16LE=tf.prototype.readUInt16LE=function(t,e){return t>>>=0,e||tC(t,2,this.length),this[t]|this[t+1]<<8},tf.prototype.readUint16BE=tf.prototype.readUInt16BE=function(t,e){return t>>>=0,e||tC(t,2,this.length),this[t]<<8|this[t+1]},tf.prototype.readUint32LE=tf.prototype.readUInt32LE=function(t,e){return t>>>=0,e||tC(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},tf.prototype.readUint32BE=tf.prototype.readUInt32BE=function(t,e){return t>>>=0,e||tC(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},tf.prototype.readBigUInt64LE=tX(function(t){tM(t>>>=0,"offset");let e=this[t],r=this[t+7];(void 0===e||void 0===r)&&tN(t,this.length-8);let i=e+256*this[++t]+65536*this[++t]+16777216*this[++t],n=this[++t]+256*this[++t]+65536*this[++t]+16777216*r;return BigInt(i)+(BigInt(n)<<BigInt(32))}),tf.prototype.readBigUInt64BE=tX(function(t){tM(t>>>=0,"offset");let e=this[t],r=this[t+7];(void 0===e||void 0===r)&&tN(t,this.length-8);let i=16777216*e+65536*this[++t]+256*this[++t]+this[++t],n=16777216*this[++t]+65536*this[++t]+256*this[++t]+r;return(BigInt(i)<<BigInt(32))+BigInt(n)}),tf.prototype.readIntLE=function(t,e,r){t>>>=0,e>>>=0,r||tC(t,e,this.length);let i=this[t],n=1,J=0;for(;++J<e&&(n*=256);)i+=this[t+J]*n;return i>=(n*=128)&&(i-=Math.pow(2,8*e)),i},tf.prototype.readIntBE=function(t,e,r){t>>>=0,e>>>=0,r||tC(t,e,this.length);let i=e,n=1,J=this[t+--i];for(;i>0&&(n*=256);)J+=this[t+--i]*n;return J>=(n*=128)&&(J-=Math.pow(2,8*e)),J},tf.prototype.readInt8=function(t,e){return(t>>>=0,e||tC(t,1,this.length),128&this[t])?-((255-this[t]+1)*1):this[t]},tf.prototype.readInt16LE=function(t,e){t>>>=0,e||tC(t,2,this.length);let r=this[t]|this[t+1]<<8;return 32768&r?4294901760|r:r},tf.prototype.readInt16BE=function(t,e){t>>>=0,e||tC(t,2,this.length);let r=this[t+1]|this[t]<<8;return 32768&r?4294901760|r:r},tf.prototype.readInt32LE=function(t,e){return t>>>=0,e||tC(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},tf.prototype.readInt32BE=function(t,e){return t>>>=0,e||tC(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},tf.prototype.readBigInt64LE=tX(function(t){tM(t>>>=0,"offset");let e=this[t],r=this[t+7];return(void 0===e||void 0===r)&&tN(t,this.length-8),(BigInt(this[t+4]+256*this[t+5]+65536*this[t+6]+(r<<24))<<BigInt(32))+BigInt(e+256*this[++t]+65536*this[++t]+16777216*this[++t])}),tf.prototype.readBigInt64BE=tX(function(t){tM(t>>>=0,"offset");let e=this[t],r=this[t+7];return(void 0===e||void 0===r)&&tN(t,this.length-8),(BigInt((e<<24)+65536*this[++t]+256*this[++t]+this[++t])<<BigInt(32))+BigInt(16777216*this[++t]+65536*this[++t]+256*this[++t]+r)}),tf.prototype.readFloatLE=function(t,e){return t>>>=0,e||tC(t,4,this.length),r(this,t,!0,23,4)},tf.prototype.readFloatBE=function(t,e){return t>>>=0,e||tC(t,4,this.length),r(this,t,!1,23,4)},tf.prototype.readDoubleLE=function(t,e){return t>>>=0,e||tC(t,8,this.length),r(this,t,!0,52,8)},tf.prototype.readDoubleBE=function(t,e){return t>>>=0,e||tC(t,8,this.length),r(this,t,!1,52,8)},tf.prototype.writeUintLE=tf.prototype.writeUIntLE=function(t,e,r,i){if(t=+t,e>>>=0,r>>>=0,!i){let i=Math.pow(2,8*r)-1;tB(this,t,e,r,i,0)}let n=1,J=0;for(this[e]=255&t;++J<r&&(n*=256);)this[e+J]=t/n&255;return e+r},tf.prototype.writeUintBE=tf.prototype.writeUIntBE=function(t,e,r,i){if(t=+t,e>>>=0,r>>>=0,!i){let i=Math.pow(2,8*r)-1;tB(this,t,e,r,i,0)}let n=r-1,J=1;for(this[e+n]=255&t;--n>=0&&(J*=256);)this[e+n]=t/J&255;return e+r},tf.prototype.writeUint8=tf.prototype.writeUInt8=function(t,e,r){return t=+t,e>>>=0,r||tB(this,t,e,1,255,0),this[e]=255&t,e+1},tf.prototype.writeUint16LE=tf.prototype.writeUInt16LE=function(t,e,r){return t=+t,e>>>=0,r||tB(this,t,e,2,65535,0),this[e]=255&t,this[e+1]=t>>>8,e+2},tf.prototype.writeUint16BE=tf.prototype.writeUInt16BE=function(t,e,r){return t=+t,e>>>=0,r||tB(this,t,e,2,65535,0),this[e]=t>>>8,this[e+1]=255&t,e+2},tf.prototype.writeUint32LE=tf.prototype.writeUInt32LE=function(t,e,r){return t=+t,e>>>=0,r||tB(this,t,e,4,4294967295,0),this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t,e+4},tf.prototype.writeUint32BE=tf.prototype.writeUInt32BE=function(t,e,r){return t=+t,e>>>=0,r||tB(this,t,e,4,4294967295,0),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},tf.prototype.writeBigUInt64LE=tX(function(t,e=0){return tT(this,t,e,BigInt(0),BigInt("0xffffffffffffffff"))}),tf.prototype.writeBigUInt64BE=tX(function(t,e=0){return tR(this,t,e,BigInt(0),BigInt("0xffffffffffffffff"))}),tf.prototype.writeIntLE=function(t,e,r,i){if(t=+t,e>>>=0,!i){let i=Math.pow(2,8*r-1);tB(this,t,e,r,i-1,-i)}let n=0,J=1,o=0;for(this[e]=255&t;++n<r&&(J*=256);)t<0&&0===o&&0!==this[e+n-1]&&(o=1),this[e+n]=(t/J>>0)-o&255;return e+r},tf.prototype.writeIntBE=function(t,e,r,i){if(t=+t,e>>>=0,!i){let i=Math.pow(2,8*r-1);tB(this,t,e,r,i-1,-i)}let n=r-1,J=1,o=0;for(this[e+n]=255&t;--n>=0&&(J*=256);)t<0&&0===o&&0!==this[e+n+1]&&(o=1),this[e+n]=(t/J>>0)-o&255;return e+r},tf.prototype.writeInt8=function(t,e,r){return t=+t,e>>>=0,r||tB(this,t,e,1,127,-128),t<0&&(t=255+t+1),this[e]=255&t,e+1},tf.prototype.writeInt16LE=function(t,e,r){return t=+t,e>>>=0,r||tB(this,t,e,2,32767,-32768),this[e]=255&t,this[e+1]=t>>>8,e+2},tf.prototype.writeInt16BE=function(t,e,r){return t=+t,e>>>=0,r||tB(this,t,e,2,32767,-32768),this[e]=t>>>8,this[e+1]=255&t,e+2},tf.prototype.writeInt32LE=function(t,e,r){return t=+t,e>>>=0,r||tB(this,t,e,4,2147483647,-2147483648),this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24,e+4},tf.prototype.writeInt32BE=function(t,e,r){return t=+t,e>>>=0,r||tB(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},tf.prototype.writeBigInt64LE=tX(function(t,e=0){return tT(this,t,e,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),tf.prototype.writeBigInt64BE=tX(function(t,e=0){return tR(this,t,e,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),tf.prototype.writeFloatLE=function(t,e,r){return tL(this,t,e,!0,r)},tf.prototype.writeFloatBE=function(t,e,r){return tL(this,t,e,!1,r)},tf.prototype.writeDoubleLE=function(t,e,r){return tU(this,t,e,!0,r)},tf.prototype.writeDoubleBE=function(t,e,r){return tU(this,t,e,!1,r)},tf.prototype.copy=function(t,e,r,i){if(!tf.isBuffer(t))throw TypeError("argument should be a Buffer");if(r||(r=0),i||0===i||(i=this.length),e>=t.length&&(e=t.length),e||(e=0),i>0&&i<r&&(i=r),i===r||0===t.length||0===this.length)return 0;if(e<0)throw RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw RangeError("Index out of range");if(i<0)throw RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),t.length-e<i-r&&(i=t.length-e+r);let n=i-r;return this===t&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(e,r,i):Uint8Array.prototype.set.call(t,this.subarray(r,i),e),n},tf.prototype.fill=function(t,e,r,i){let n;if("string"==typeof t){if("string"==typeof e?(i=e,e=0,r=this.length):"string"==typeof r&&(i=r,r=this.length),void 0!==i&&"string"!=typeof i)throw TypeError("encoding must be a string");if("string"==typeof i&&!tf.isEncoding(i))throw TypeError("Unknown encoding: "+i);if(1===t.length){let e=t.charCodeAt(0);("utf8"===i&&e<128||"latin1"===i)&&(t=e)}}else"number"==typeof t?t&=255:"boolean"==typeof t&&(t=Number(t));if(e<0||this.length<e||this.length<r)throw RangeError("Out of range index");if(r<=e)return this;if(e>>>=0,r=void 0===r?this.length:r>>>0,t||(t=0),"number"==typeof t)for(n=e;n<r;++n)this[n]=t;else{let J=tf.isBuffer(t)?t:tf.from(t,i),o=J.length;if(0===o)throw TypeError('The value "'+t+'" is invalid for argument "value"');for(n=0;n<r-e;++n)this[n+e]=J[n%o]}return this};let tI={};function tD(t,e,r){tI[t]=class extends r{constructor(){super(),Object.defineProperty(this,"message",{value:e.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${t}]`,this.stack,delete this.name}get code(){return t}set code(t){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:t,writable:!0})}toString(){return`${this.name} [${t}]: ${this.message}`}}}function tF(t){let e="",r=t.length,i="-"===t[0]?1:0;for(;r>=i+4;r-=3)e=`_${t.slice(r-3,r)}${e}`;return`${t.slice(0,r)}${e}`}function tS(t,e,r,i,n,J){if(t>r||t<e){let i;let n="bigint"==typeof e?"n":"";throw i=J>3?0===e||e===BigInt(0)?`>= 0${n} and < 2${n} ** ${(J+1)*8}${n}`:`>= -(2${n} ** ${(J+1)*8-1}${n}) and < 2 ** ${(J+1)*8-1}${n}`:`>= ${e}${n} and <= ${r}${n}`,new tI.ERR_OUT_OF_RANGE("value",i,t)}tM(n,"offset"),(void 0===i[n]||void 0===i[n+J])&&tN(n,i.length-(J+1))}function tM(t,e){if("number"!=typeof t)throw new tI.ERR_INVALID_ARG_TYPE(e,"number",t)}function tN(t,e,r){if(Math.floor(t)!==t)throw tM(t,r),new tI.ERR_OUT_OF_RANGE(r||"offset","an integer",t);if(e<0)throw new tI.ERR_BUFFER_OUT_OF_BOUNDS;throw new tI.ERR_OUT_OF_RANGE(r||"offset",`>= ${r?1:0} and <= ${e}`,t)}tD("ERR_BUFFER_OUT_OF_BOUNDS",function(t){return t?`${t} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),tD("ERR_INVALID_ARG_TYPE",function(t,e){return`The "${t}" argument must be of type number. Received type ${typeof e}`},TypeError),tD("ERR_OUT_OF_RANGE",function(t,e,r){let i=`The value of "${t}" is out of range.`,n=r;return Number.isInteger(r)&&Math.abs(r)>4294967296?n=tF(String(r)):"bigint"==typeof r&&(n=String(r),(r>BigInt(2)**BigInt(32)||r<-(BigInt(2)**BigInt(32)))&&(n=tF(n)),n+="n"),i+=` It must be ${e}. Received ${n}`},RangeError);let tP=/[^+/0-9A-Za-z-_]/g;function tk(t,e){let r;e=e||1/0;let i=t.length,n=null,J=[];for(let o=0;o<i;++o){if((r=t.charCodeAt(o))>55295&&r<57344){if(!n){if(r>56319||o+1===i){(e-=3)>-1&&J.push(239,191,189);continue}n=r;continue}if(r<56320){(e-=3)>-1&&J.push(239,191,189),n=r;continue}r=(n-55296<<10|r-56320)+65536}else n&&(e-=3)>-1&&J.push(239,191,189);if(n=null,r<128){if((e-=1)<0)break;J.push(r)}else if(r<2048){if((e-=2)<0)break;J.push(r>>6|192,63&r|128)}else if(r<65536){if((e-=3)<0)break;J.push(r>>12|224,r>>6&63|128,63&r|128)}else if(r<1114112){if((e-=4)<0)break;J.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}else throw Error("Invalid code point")}return J}function tK(e){return t(function(t){if((t=(t=t.split("=")[0]).trim().replace(tP,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(e))}function tV(t,e,r,i){let n;for(n=0;n<i&&!(n+r>=e.length)&&!(n>=t.length);++n)e[n+r]=t[n];return n}function tj(t,e){return t instanceof e||null!=t&&null!=t.constructor&&null!=t.constructor.name&&t.constructor.name===e.name}let tG=function(){let t="0123456789abcdef",e=Array(256);for(let r=0;r<16;++r){let i=16*r;for(let n=0;n<16;++n)e[i+n]=t[r]+t[n]}return e}();function tX(t){return"undefined"==typeof BigInt?tY:t}function tY(){throw Error("BigInt not supported")}tn=function(){var t,e,r,i,J="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==n?n:"undefined"!=typeof self?self:{},o=(t=i={exports:{}},e=i.exports,r=function(){var t="function"==typeof Promise,e="object"==typeof self?self:J,r="undefined"!=typeof Symbol,i="undefined"!=typeof Map,n="undefined"!=typeof Set,o="undefined"!=typeof WeakMap,s="undefined"!=typeof WeakSet,a="undefined"!=typeof DataView,h=r&&void 0!==Symbol.iterator,l=r&&void 0!==Symbol.toStringTag,u=n&&"function"==typeof Set.prototype.entries,c=i&&"function"==typeof Map.prototype.entries,f=u&&Object.getPrototypeOf(new Set().entries()),d=c&&Object.getPrototypeOf(new Map().entries()),p=h&&"function"==typeof Array.prototype[Symbol.iterator],g=p&&Object.getPrototypeOf([][Symbol.iterator]()),y=h&&"function"==typeof String.prototype[Symbol.iterator],m=y&&Object.getPrototypeOf(""[Symbol.iterator]());return function(r){var J=typeof r;if("object"!==J)return J;if(null===r)return"null";if(r===e)return"global";if(Array.isArray(r)&&(!1===l||!(Symbol.toStringTag in r)))return"Array";if("object"==typeof window&&null!==window){if("object"==typeof window.location&&r===window.location)return"Location";if("object"==typeof window.document&&r===window.document)return"Document";if("object"==typeof window.navigator){if("object"==typeof window.navigator.mimeTypes&&r===window.navigator.mimeTypes)return"MimeTypeArray";if("object"==typeof window.navigator.plugins&&r===window.navigator.plugins)return"PluginArray"}if(("function"==typeof window.HTMLElement||"object"==typeof window.HTMLElement)&&r instanceof window.HTMLElement){if("BLOCKQUOTE"===r.tagName)return"HTMLQuoteElement";if("TD"===r.tagName)return"HTMLTableDataCellElement";if("TH"===r.tagName)return"HTMLTableHeaderCellElement"}}var h=l&&r[Symbol.toStringTag];if("string"==typeof h)return h;var u=Object.getPrototypeOf(r);return u===RegExp.prototype?"RegExp":u===Date.prototype?"Date":t&&u===Promise.prototype?"Promise":n&&u===Set.prototype?"Set":i&&u===Map.prototype?"Map":s&&u===WeakSet.prototype?"WeakSet":o&&u===WeakMap.prototype?"WeakMap":a&&u===DataView.prototype?"DataView":i&&u===d?"Map Iterator":n&&u===f?"Set Iterator":p&&u===g?"Array Iterator":y&&u===m?"String Iterator":null===u?"Object":Object.prototype.toString.call(r).slice(8,-1)}},t.exports=r(),i.exports);let s=void 0!==tf.from?function(t){return tf.from(t)}:function(t){return new tf(t)};function a(t){return tf.isBuffer(t)?"Buffer":o(t)}let h=new Set(["Arguments","Array","Map","Object","Set"]);function l(t,e,r,i=null){switch(i||a(t)){case"Arguments":case"Array":case"Object":t[e]=r;break;case"Map":t.set(e,r);break;case"Set":t.add(r)}return t}let u="undefined"!=typeof globalThis&&null!==globalThis&&globalThis.Object===Object&&globalThis,c=null!=n&&n.Object===Object&&n,f="undefined"!=typeof self&&null!==self&&self.Object===Object&&self,d=u||c||f||Function("return this")();function p(t,e){return d[e].from?d[e].from(t):new d[e](t)}function g(t){return t}function y(){return[]}var m=new Map([["ArrayBuffer",function(t){return t.slice(0)}],["Boolean",function(t){return new Boolean(t.valueOf())}],["Buffer",function(t){return s(t)}],["DataView",function(t){return new DataView(t.buffer)}],["Date",function(t){return new Date(t.getTime())}],["Number",function(t){return new Number(t)}],["RegExp",function(t){return new RegExp(t.source,t.flags)}],["String",function(t){return new String(t)}],["Float32Array",p],["Float64Array",p],["Int16Array",p],["Int32Array",p],["Int8Array",p],["Uint16Array",p],["Uint32Array",p],["Uint8Array",p],["Uint8ClampedArray",p],["Array Iterator",g],["Map Iterator",g],["Promise",g],["Set Iterator",g],["String Iterator",g],["function",g],["global",g],["WeakMap",g],["WeakSet",g],["boolean",g],["null",g],["number",g],["string",g],["symbol",g],["undefined",g],["Arguments",y],["Array",y],["Map",function(){return new Map}],["Object",function(){return{}}],["Set",function(){return new Set}]]);function w(){}function b(t,e=null,r=w){2==arguments.length&&"function"==typeof e&&(r=e,e=null);let i=e||a(t),n=m.get(i);if("Object"===i){let e=r(t,i);if(void 0!==e)return e}return n?n(t,i):t}function v(t,e,r,i,n){let J;let o=a(t),s=b(t,o);if(!h.has(o))return s;switch(o){case"Arguments":case"Array":J=Object.keys(t);break;case"Object":(J=Object.keys(t)).push(...Object.getOwnPropertySymbols(t));break;case"Map":case"Set":J=t.keys()}for(let n of J){let J=function(t,e,r=null){switch(r||a(t)){case"Arguments":case"Array":case"Object":return t[e];case"Map":return t.get(e);case"Set":return e}}(t,n,o);if(i.has(J))l(e,n,r.get(J),o);else{let t=a(J),s=b(J,t);h.has(t)&&(r.set(J,s),i.add(J)),l(e,n,v(J,s,r,i),o)}}return e}return function(t,e={}){"function"==typeof e&&(e={customizer:e});let{customizer:r}=e,i=a(t);if(!h.has(i))return v(t,null,null,null);let n=b(t,i,r),J=new WeakMap([[t,n]]),o=new WeakSet([t]);return v(t,n,J,o)}}();let tH={" ":"black","#":"silver","%":"charcoal",:"silver blue","":"silver blue","":"silver blue","":"silver blue",:"silver blue",J:"charcoal","~":"charcoal",".":"charcoal",":":"charcoal","":"charcoal",";":"charcoal",$:"white","":"red","":"red",:"red","":"silver green","":"silver green","":"silver green","@":"white"},tW=["","","","",""],tz=[" "," "," "," ",":",":",":",":",":",":","","",";","","",""],t$=["%","#"],tq=["A","B","C","D","E","F"],tQ={A:[1,1],B:[2,1],C:[1,2],D:[2,2],E:[3,1],F:[1,3],V:[0,0],W:[1,1]},tZ={A:[["###J###","#  J  #","JJ   JJ","#  J  #","###J###"],["##.J.##","#..J..#","JJ   JJ","#..J...","###J.##"],["JJJJ##J","J##  #J","J#   #J","J## ##J","JJJJJJJ"],["###J###","#     #","J  ~  J","#     #","###J###"],["J#.JJ##","J #.  #","J ... J","J #.  #","J#.JJ##"],["JJ#J#JJ","### ###","J     J","###~###","JJ###JJ"],["JJJJJJJ","J  ###J","J### #J","J#   #J","JJJJJJJ"],["###JJJJ","#     J","### ###","J     #","JJJJ###"],["##JJJJJ","# #   J","J ####J","#     #","###J###"],["J##J##J","#    #","J ::: J","#    #","J##J##J"],["JJJJJJJ","J####J","J####J","J##J","JJJJJJJ"],["J#JJJJJ","J######","J#    J","J#### J","JJJJ#JJ"],["J##J##J","J#~ ~#J","J     J","J#~  #J","J##J##J"],["##%J###","#%  #.#","J     J","#     %","###J#%#"],["###J%%%","#   % #","J  %  J","%%%   #","%##J###"]],C:[["###J###","#     #","J     J","#     #","#     #","#     #","#     #","J     J","#     #","###J###"],["###J###","# # # J","J # # J","J # # J","J # # J","J # # J","J # # J","J ### J","#     J","###JJJJ"],["###JJJJ","###   J","J     J","#     #","# #   #","# #####","# #####","J     J","# #   J","###JJJJ"],["###J###","#     #","J     J","#  %%%#","#  ~%#","#   %#","#  % %#","J     J","#     #","###J###"],["###J###","#     #","J ### J","# #~# #","#     #","#    #","##   ##","J     J","#~# #~#","###J###"],["###J###","#     #","J     J","##### #","J   # #","J   # #","##### #","J     J","#     #","###J###"],["###J###","#     #","J     J","# # # #","J     J","J     J","# # # #","J     J","#     #","###J###"],["##JJJ##","# # # #","J # # J","# # # J","# . ##","# #####","# #   #","J #~  J","# #   #","#######"],["JJJJ###","J    ##","J    #J","#....##","#     #","#~#   #","###   #","J#    J","##    J","###JJJJ"],["JJ#J#JJ","### ###","J     J","##  ~##","J#   #J","J#   #J","##  ##","J     J","### ###","JJ#J#JJ"]],B:[["###J######J###","#            #","J            J","#            #","###J######J###"],["........##J###","#......#     #","JJ....#      J","#....#       #","....######J###"],["###J#JJJJ#J###","# ~ #    # ..#","J   #    #.. J","# ~ #    #.. #","###J#JJJJ#J###"],["###J######J###","##        #","J#         J","###        ###","###J######J#JJ"],["JJJJ######JJJJ","J            J","J            J","### #####   J","###J######JJJJ"],["###J######J###","#      #~# #~#","J            J","#            #","###J######J###"],["###J######J###","#            #","#  ~   ~     J","#            #","##########J###"],["JJJJ##########","J   #  #  #  #","J   #  #  #  #","J  ##  #  #  #","JJJJJJJ#JJ#JJJ"],["###J######J#JJ","#          # J","J         #  J","#        #   J","###J#####JJJJJ"],["JJJJJJJJJJJJJJ","#        ... #","#      ......#","# ############","JJJJJJJJJJJJJJ"],["####JJ####J###","J  #  #      #","J###  #      J","#     #      #","JJJJJJ####J###"],["###J......J###","#            #","J      J","#            #","###J......J###"]],D:[["###J######J###","#            #","J            J","#            #","#            #","#            #","#            #","J            J","#            #","###J######J###"],["###JJJJJJJJ###","#            #","J       #    J","J   ....#.   J","J ###########J","J  # ...#... J","J  # ...#.   J","J  #   .#    J","#       #    #","###JJJJJJJJ###"],["###J######J###","#      #     #","J      #     J","#     ##     #","#            #","#         ####","# ###     #  #","J   #        J","#            #","###J######J###"],["JJJJ######JJJJ","J            J","J #####....  J","# #   #####  J","# ##      ####","#  #         #","#  #       ###","J  #   ##### J","J  #.###     J","JJJJJJJJJJJJJJ"],["##########JJJJ","#     ..  #  J","# .   ...  # J","# .         #J","# ##  ...   #","# #~    ..   #","# ##~#       #","#  ###  .    J","#     ...    #","##########J###"],["JJJJJJJJJJJJJJ","J  ##        J","J  ##        J","J## #        J","J###.##      J","J  #...##    J","J   #....#   J","J  #.#....#  J","J  ## #### ##J","JJJJJJJJJJJJJJ"],["###J######J###","#%%J%%%%%%J%##","JJJ##JJJ","#%%%%%%#","#%  %%#","#% %%#","#%%%%% #","JJ %% JJ","#  J%%%%%%J  #","###J######J###"]],E:[["%J%J######JJJJJJJJ%%%","%J%      #       %  %","##%%%%%  #       %  J","#                %  %","###J######JJJJJJJJ%%%"],["###J######J######J###","#                   #","J                   J","#                   #","###J######J######J###"],["###J##.........##J###","#      .......      #","J     ..  ....      J","#   ....   .....  ..#","###J######J######J###"],["###JJJJJJJJ######J###","#              ~#   #","J          ######   J","#                   #","###J######J######J###"],["JJ#JJJJJ##JJJJ###JJ#J","J #   # #     # #   J","J #####         ####J","J   #   #     #     J","JJJJ#JJJ##JJJJ###JJ##"],["###J######J######J###","#      #   #    ####","J    #~   #        J","# ###  #  #       #","###J######J######J###"],["###J#JJJJJJJJJJJ#J###","#    #         #    #","J     #       # #   J","#      #     #   #  #","###JJJJJ##J##JJJJJ###"],["###J%%%%%%J%%%%%%J###","#   %% #%   #","J   % % % %   J","#   # % %%   #","###J%%%%%%J%%%%%%J###"],["###J######J######J###","#       ~#J#~  .J..#","J             ..JJ","#               #J#.#","###J######J######J###"]],F:[["###J###","#     #","J     J","#     #","#     #","#     #","#     #","J     J","#     #","#     #","#     #","#     #","J     J","#     #","###J###"],["JJJJJJJ","J     J","J     J","J.    J","J..   J","J ..  J","J  .. J","J   ..J","J    .#","J    ##","J   # #","J  #  #","J #   J","J~    #","###J###"],["#JJJJJ#","#.....#","J     J","#.....#","#     #","#.....#","#     #","#     J","#     #","#.....#","#     #","#.....#","J     #","#     #","#######"],["###J###","#~    #","J     J","#  # .#","#  # .#","#    .#","#    .#","J    .J","# # #.#","#    .#","# ###.J","J   #.J","J   #.J","J   #.J","JJJJ##J"],["JJJJJJJ","J#### J","J## J","J#   J","J#### J","J     J","J ####J","J #  J","J ##J","J ####J","J     J","J# ## J","J# # J","J## J","J####JJ"],["###JJJJ","#     J","##    J","J#### #","J##   #","J#    #","##    #","J     J","#  ####","# ###JJ","#   #JJ","#   ###","J     J","J     #","JJJJ###"],["JJJJ###","J  #  #","J #   J","# ### #","#...# #","#..#  #","###  ##","J   # J","#   # #","J#  # #","J # # #","### # #","J   # J","J    ##","JJJJJJJ"],["%%%#%%%","%  %","#   #","%  %","%   %","%  %","%   %","#  #","%   %","%  %","%   %","%  %","#   #","%  %","%%%#%%%"]],V:[["JJJJJJJ","J     J","J     J","J     J","JJJJJJJ"]],W:[["JJJJJJJ","J  ## J","J  #. J","J  .  J","JJJJJJJ"],["JJJJJJJ","J.    J","J...  J","J.    J","J.JJJJJ"],["JJ.JJJJ","J   ..J","J #   J","J   #~#","JJJJ###"],["JJ####J","J #   J","J##   J","J .   J","JJ#JJJJ"],["JJJJJJJ","J  .  J","J  .. J","J.. ..J","JJJJJJJ"],["JJJJJJJ",".  ###J",".     J",".. J  J","...J.JJ"],["JJ#JJJJ","J #   J","J # # J","J.#.###","JJJJJJJ"],["JJJJJ#.","J#...##","J.   .J","J.   #J","J#JJJJJ"],["J#JJJJJ","J#    J","J#    J","J#.....","JJJJJJJ"],["JJJJJ.J","J     J","J.    J","..   #J","J.JJJ.J"],["JJ####J","J #   J","J##   J","J .   J","JJ#JJJJ"],["JJJJJJJ","J  .  J","J  .. J","J.. ..J","JJJJJJJ"],["JJJJJJJ",".  ###J",".     J",".. J  J","...J.JJ"],["JJ#JJJJ","J #   J","J # # J","J.#.###","JJJJJJJ"],["JJJJJ#.","J#...##","J.   .J","J.   #J","J#JJJJJ"],["J#JJJJJ","J#    J","J#    J","J#.....","JJJJJJJ"],["JJJJJ.J","J     J","J.    J","..   #J","J.JJJ.J"],["...JJJJ","....  J","..... J","......J","......."],["JJ..JJJ","J#..# J","J .# .J","J   ..J","JJJ####"],["##JJJJ#","J ..  J","J ..  J","#    ##","#JJJJ##"],["JJ#JJJJ","J.... J","J   . J","J#    J","JJJJJJJ"],["...JJJJ","....  J","..... J","......J","......."],["JJ..JJJ","J#..# J","J .# .J","J   ..J","JJJ####"],["##JJJJ#","J ..  J","J ..  J","#    ##","#JJJJ##"],["JJ#JJJJ","J.... J","J   . J","J#    J","JJJJJJJ"],["J#JJJJJ","J #   J","J  ~  J","J   # J","JJJJJ#J"],["JJJJJJJ","J# .  J","J    J","J# #  J","JJJJJJJ"],["JJJJJJJ","J%%%%%J","J%#J","J%%%%#J","JJJJJJJ"],["JJJJJJJ","####  J","#     J","J     J","JJJJJJJ"],["JJJJJJJ","J ... J","J.  .J","J.....J","JJJJJJJ"],["#J#J#JJ","#J J  J","J    .J","J  . ..","JJ....."],["J.....J","J   . J","J  .  J","J .   J","J.....J"],["#J#J#JJ","#J J  J","J    .J","J  . ..","JJ....."],["J.....J","J   . J","J  .  J","J .   J","J.....J"],["J~~~~~J","J   ~ J","J  ~  J","J ~   J","J~~~~~J"],["#J#J#JJ","#JJ  J","J     J","J  JJ#","JJ#J#J#"],[".......",". ..  .",". .   .",".     .","......."],["JJJJJJJ","J%.   J","J..   J","J     J","JJJJJJJ"],["###JJJJ","J ....J","J .   J","J .   #","JJ.JJJ#"],["JJ...JJ","... ...","J ... J","J  .  J","J.....J"],["###JJJJ","J ....J","J .   J","J .   #","JJ.JJJ#"],["JJ...JJ","... ...","J ... J","J  .  J","J.....J"],["JJJJJJJ","J    J","J    J","J    J","JJJJJJJ"],["JJJJJJ","     ","J     J","J     J","JJJJJ"],[".#JJJ#.","##   ##","J     J","J     J",".JJJJJJ"],["JJJJJJJ","###   J","JJ    J","#  ####","JJJJJJJ"],["JJJJJJJ","J  ## J","J  #. J","J  .  J","JJJJJJJ"],["JJJJJJJ","J.    J","J...  J","J.    J","J.JJJJJ"],["JJ.JJJJ","J   ..J","J #   J","J   #~#","JJJJ###"],["JJ####J","J #   J","J##   J","J .   J","JJ#JJJJ"],["JJJJJJJ","J  .  J","J  .. J","J.. ..J","JJJJJJJ"],["JJJJJJJ",".  ###J",".     J",".. J  J","...J.JJ"],["JJ#JJJJ","J #   J","J # # J","J.#.###","JJJJJJJ"],["JJJJJ#.","J#...##","J.   .J","J.   #J","J#JJJJJ"],["J#JJJJJ","J#    J","J#    J","J#.....","JJJJJJJ"],["JJJJJ.J","J     J","J.    J","..   #J","J.JJJ.J"],["JJ####J","J #   J","J##   J","J .   J","JJ#JJJJ"],["JJJJJJJ","J  .  J","J  .. J","J.. ..J","JJJJJJJ"],["JJJJJJJ",".  ###J",".     J",".. J  J","...J.JJ"],["JJ#JJJJ","J #   J","J # # J","J.#.###","JJJJJJJ"],["JJJJJ#.","J#...##","J.   .J","J.   #J","J#JJJJJ"],["J#JJJJJ","J#    J","J#    J","J#.....","JJJJJJJ"],["JJJJJ.J","J     J","J.    J","..   #J","J.JJJ.J"],["...JJJJ","....  J","..... J","......J","......."],["JJ..JJJ","J#..# J","J .# .J","J   ..J","JJJ####"],["##JJJJ#","J ..  J","J ..  J","#    ##","#JJJJ##"],["JJ#JJJJ","J.... J","J   . J","J#    J","JJJJJJJ"],["...JJJJ","....  J","..... J","......J","......."],["JJ..JJJ","J#..# J","J .# .J","J   ..J","JJJ####"],["##JJJJ#","J ..  J","J ..  J","#    ##","#JJJJ##"],["JJ#JJJJ","J.... J","J   . J","J#    J","JJJJJJJ"],["JJJJJJJ","####  J","#     J","J     J","JJJJJJJ"],["#J#J#JJ","#J J  J","J    .J","J  . ..","JJ....."],["J.....J","J   . J","J  .  J","J .   J","J.....J"],["#J#J#JJ","#J J  J","J    .J","J  . ..","JJ....."],["J.....J","J   . J","J  .  J","J .   J","J.....J"],[".......",". ..  .",". .   .",".     .","......."],["###JJJJ","J ....J","J .   J","J .   #","JJ.JJJ#"],["JJ...JJ","... ...","J ... J","J  .  J","J.....J"],["###JJJJ","J ....J","J .   J","J .   #","JJ.JJJ#"],["JJ...JJ","... ...","J ... J","J  .  J","J.....J"],[".#JJJ#.","##   ##","J     J","J     J",".JJJJJJ"],["JJJJJJJ","###   J","JJ    J","#  ####","JJJJJJJ"],["JJJJJJJ","J  ## J","J  #. J","J  .  J","JJJJJJJ"],["JJJJJJJ","J.    J","J...  J","J.    J","J.JJJJJ"],["JJ.JJJJ","J   ..J","J #   J","J   #~#","JJJJ###"],["JJ####J","J #   J","J##   J","J .   J","JJ#JJJJ"],["JJJJJJJ","J  .  J","J  .. J","J.. ..J","JJJJJJJ"],["JJJJJJJ",".  ###J",".     J",".. J  J","...J.JJ"],["JJ#JJJJ","J #   J","J # # J","J.#.###","JJJJJJJ"],["JJJJJ#.","J#...##","J.   .J","J.   #J","J#JJJJJ"],["J#JJJJJ","J#    J","J#    J","J#.....","JJJJJJJ"],["JJJJJ.J","J     J","J.    J","..   #J","J.JJJ.J"],["JJ####J","J #   J","J##   J","J .   J","JJ#JJJJ"],["JJJJJJJ","J  .  J","J  .. J","J.. ..J","JJJJJJJ"],["JJJJJJJ",".  ###J",".     J",".. J  J","...J.JJ"],["JJ#JJJJ","J #   J","J # # J","J.#.###","JJJJJJJ"],["JJJJJ#.","J#...##","J.   .J","J.   #J","J#JJJJJ"],["J#JJJJJ","J#    J","J#    J","J#.....","JJJJJJJ"],["JJJJJ.J","J     J","J.    J","..   #J","J.JJJ.J"],["...JJJJ","....  J","..... J","......J","......."],["JJ..JJJ","J#..# J","J .# .J","J   ..J","JJJ####"],["##JJJJ#","J ..  J","J ..  J","#    ##","#JJJJ##"],["JJ#JJJJ","J.... J","J   . J","J#    J","JJJJJJJ"],["...JJJJ","....  J","..... J","......J","......."],["JJ..JJJ","J#..# J","J .# .J","J   ..J","JJJ####"],["##JJJJ#","J ..  J","J ..  J","#    ##","#JJJJ##"],["JJ#JJJJ","J.... J","J   . J","J#    J","JJJJJJJ"],["J#JJJJJ","J #   J","J  ~  J","J   # J","JJJJJ#J"],["JJJJJJJ","J# .  J","J    J","J# #  J","JJJJJJJ"],["JJJJJJJ","J%%%%%J","J%#J","J%%%%#J","JJJJJJJ"],["JJJJJJJ","####  J","#     J","J     J","JJJJJJJ"],["JJJJJJJ","J ... J","J.  .J","J.....J","JJJJJJJ"],["#J#J#JJ","#J J  J","J    .J","J  . ..","JJ....."],["J.....J","J   . J","J  .  J","J .   J","J.....J"],["#J#J#JJ","#J J  J","J    .J","J  . ..","JJ....."],["J.....J","J   . J","J  .  J","J .   J","J.....J"],["J~~~~~J","J   ~ J","J  ~  J","J ~   J","J~~~~~J"],["#J#J#JJ","#JJ  J","J     J","J  JJ#","JJ#J#J#"],[".......",". ..  .",". .   .",".     .","......."],["JJJJJJJ","J%.   J","J..   J","J     J","JJJJJJJ"],["###JJJJ","J ....J","J .   J","J .   #","JJ.JJJ#"],["JJ...JJ","... ...","J ... J","J  .  J","J.....J"],["###JJJJ","J ....J","J .   J","J .   #","JJ.JJJ#"],["JJ...JJ","... ...","J ... J","J  .  J","J.....J"],["JJJJJJJ","J    J","J    J","J    J","JJJJJJJ"],["JJJJJJ","     ","J     J","J     J","JJJJJ"],[".#JJJ#.","##   ##","J     J","J     J",".JJJJJJ"],["JJJJJJJ","###   J","JJ    J","#  ####","JJJJJJJ"],["JJJJJJJ","J  ## J","J  #. J","J  .  J","JJJJJJJ"],["JJJJJJJ","J.    J","J...  J","J.    J","J.JJJJJ"],["JJ.JJJJ","J   ..J","J #   J","J   #~#","JJJJ###"],["JJ####J","J #   J","J##   J","J .   J","JJ#JJJJ"],["JJJJJJJ","J  .  J","J  .. J","J.. ..J","JJJJJJJ"],["JJJJJJJ",".  ###J",".     J",".. J  J","...J.JJ"],["JJ#JJJJ","J #   J","J # # J","J.#.###","JJJJJJJ"],["JJJJJ#.","J#...##","J.   .J","J.   #J","J#JJJJJ"],["J#JJJJJ","J#    J","J#    J","J#.....","JJJJJJJ"],["JJJJJ.J","J     J","J.    J","..   #J","J.JJJ.J"],["JJ####J","J #   J","J##   J","J .   J","JJ#JJJJ"],["JJJJJJJ","J  .  J","J  .. J","J.. ..J","JJJJJJJ"],["JJJJJJJ",".  ###J",".     J",".. J  J","...J.JJ"],["JJ#JJJJ","J #   J","J # # J","J.#.###","JJJJJJJ"],["JJJJJ#.","J#...##","J.   .J","J.   #J","J#JJJJJ"],["J#JJJJJ","J#    J","J#    J","J#.....","JJJJJJJ"],["JJJJJ.J","J     J","J.    J","..   #J","J.JJJ.J"],["...JJJJ","....  J","..... J","......J","......."],["JJ..JJJ","J#..# J","J .# .J","J   ..J","JJJ####"],["##JJJJ#","J ..  J","J ..  J","#    ##","#JJJJ##"],["JJ#JJJJ","J.... J","J   . J","J#    J","JJJJJJJ"],["...JJJJ","....  J","..... J","......J","......."],["JJ..JJJ","J#..# J","J .# .J","J   ..J","JJJ####"],["##JJJJ#","J ..  J","J ..  J","#    ##","#JJJJ##"],["JJ#JJJJ","J.... J","J   . J","J#    J","JJJJJJJ"],["JJJJJJJ","####  J","#     J","J     J","JJJJJJJ"],["#J#J#JJ","#J J  J","J    .J","J  . ..","JJ....."],["J.....J","J   . J","J  .  J","J .   J","J.....J"],["#J#J#JJ","#J J  J","J    .J","J  . ..","JJ....."],["J.....J","J   . J","J  .  J","J .   J","J.....J"],[".......",". ..  .",". .   .",".     .","......."],["###JJJJ","J ....J","J .   J","J .   #","JJ.JJJ#"],["JJ...JJ","... ...","J ... J","J  .  J","J.....J"],["###JJJJ","J ....J","J .   J","J .   #","JJ.JJJ#"],["JJ...JJ","... ...","J ... J","J  .  J","J.....J"],[".#JJJ#.","##   ##","J     J","J     J",".JJJJJJ"],["JJJJJJJ","###   J","JJ    J","#  ####","JJJJJJJ"]]};function t0(t){return Math.floor(Math.sqrt(t))}function t1(t){return 40+t.body*t0(t.level)}function t2(t){return t0(t.body+t.level)}class t5{constructor(t,e,r){this.width=t,this.height=e;let i=[];for(let n=0;n<e;n++){let e=[];for(let i=0;i<t;i++)e.push(r(i,n));i.push(e)}this.cells=i}contains(t,e){return t>=0&&t<this.width&&e>=0&&e<this.height}get(t,e){return this.cells[e][t]}set(t,e,r){this.cells[e][t]=r}paste(t,e,r){for(let i=0;i<r.width;i++)for(let n=0;n<r.height;n++)this.set(t+i,e+n,r.get(i,n))}setHLine(t,e,r,i){for(let n=t;n<=e;n++)this.cells[r][n]=i(n,r)}setVLine(t,e,r,i){for(let n=e;n<=r;n++)this.cells[n][t]=i(t,n)}carve(t,e,r,i,n,J){for(let o=0;o<r;o++){let s=0===o||o===r-1;for(let r=0;r<i;r++){let a=0===r||r===i-1;this.set(t+o,e+r,s||a?n:J)}}}expand(t,e,r){return new t5(this.width+t,this.height+e,r)}flipH(){let t=this.width-1;return new t5(this.width,this.height,(e,r)=>this.get(t-e,r))}flipV(){let t=this.height-1;return new t5(this.width,this.height,(e,r)=>this.get(e,t-r))}toString(t){let e="";for(let r=0;r<this.height;r++){for(let i=0;i<this.width;i++)e+=t(this.get(i,r),i,r);e+="\n"}return e}forEach(t){for(let e=0;e<this.height;e++)for(let r=0;r<this.width;r++)t(this.get(r,e),r,e)}}class t6 extends t5{isBlocked(t,e){return!this.contains(t,e)||this.get(t,e).blocks}}let t3=(t,e)=>{let r=[];for(let i=0;i<t;i++)r.push(e(i));return r};class t8{constructor(t,e){this.g=t,this.floorlv=e,this.debug=J(l)("aag"),this.decor=t3(3,()=>t.choose(tW)),this.floorplan=new t5(5,5,()=>"V");let r=t.rng.randRange(4,48);for(let e=0;e<r;e++){let r=this.floorplan.width,i=this.floorplan.height,n=t.rng.randRange(0,r-1),J=t.rng.randRange(0,i-1);0===e&&(n=0,J=0);let o=t.choose(tq),[s,a]=tQ[o];this.empty_check(n,J,s,a,o,!0),this.expand_plan(r,i)}this.wasteland(),this.simpleplan(),this.areaBank=J(tn)(tZ),this.pickrooms(),this.map=new t6(this.tiles.width,this.tiles.height,(e,r)=>{let i=this.tiles.get(e,r),n=t$.includes(i),J=tH[i]||"white";return{glyph:i,colour:t.palette[J],opaque:n,blocks:n}})}empty_check(t,e,r,i,n,J=!1){let o=!0,s=[];for(let n=0;n<i;n++)if(e+n<this.floorplan.height)for(let i=0;i<r;i++)t+i<this.floorplan.width?(s.push([t+i,e+n]),"V"!==this.floorplan.get(t+i,e+n)&&(o=!1)):o=!1;else o=!1;if(J&&o){let t=!0;for(let[e,r]of s){let i=t?n:"X";this.floorplan.set(e,r,i),t=!1}}return o}expand_plan(t,e){let r=!1,i=!1,n=!1,J=!1;for(let n=0;n<t;n++)"V"!==this.floorplan.get(n,0)&&(r=!0),"V"!==this.floorplan.get(n,e-1)&&(i=!0);for(let r=0;r<e;r++)"V"!==this.floorplan.get(0,r)&&(n=!0),"V"!==this.floorplan.get(t-1,r)&&(J=!0);let{width:o,height:s}=this.floorplan;r&&(this.floorplan=this.floorplan.expand(0,1,(t,e)=>0===e?"V":this.floorplan.get(t,e-1))),i&&(this.floorplan=this.floorplan.expand(0,1,(t,e)=>e===s?"V":this.floorplan.get(t,e))),n&&this.floorplan.expand(1,0,(t,e)=>0===t?"V":this.floorplan.get(t-1,e)),J&&this.floorplan.expand(1,0,(t,e)=>t===o?"V":this.floorplan.get(t,e))}wasteland(){let t=[];for(let e=0;e<this.floorplan.height;e++)for(let r=0;r<this.floorplan.width;r++)this.scan_around(this.floorplan,r,e,"V",["A","B","C","D","E","F","X"])&&t.push([r,e]);for(let[e,r]of t)this.floorplan.set(e,r,"W")}scan_around(t,e,r,i,n){let J=!1;if(t.get(e,r)===i){let i=[0,1,0,-1],o=[-1,0,1,0];for(let s=0;s<4;s++){let a=e+i[s],h=r+o[s];t.contains(a,h)&&n.includes(t.get(a,h))&&(J=!0)}}return J}simpleplan(){this.debug("simple plan","\n"+this.floorplan.toString(t=>"V"===t?" ":"W"===t?"_":"#"))}pickrooms(){let t=7*this.floorplan.width,e=5*this.floorplan.height;this.tiles=new t5(t,e,()=>" ");for(let t=0;t<this.floorplan.height;t++)for(let e=0;e<this.floorplan.width;e++){let r=this.floorplan.get(e,t);"V"!==r&&"X"!==r&&this.pasteroom(7*e,5*t,r)}let r=[];for(let i=0;i<e;i++)for(let e=0;e<t;e++)this.scan_around(this.tiles,e,i,"J",["J"])&&r.push([e,i]);for(let[t,e]of r)this.tiles.set(t,e," ");this.tiles=this.tiles.expand(2,2,(t,e)=>{let r=t-1,i=e-1;return this.tiles.contains(r,i)?this.tiles.get(r,i):"%"}),t+=2,e+=2;let i=[];for(let r=0;r<e;r++)for(let e=0;e<t;e++)this.scan_around(this.tiles,e,r," ",["#"])&&i.push([e,r]);let n=Math.min(i.length,t0(t+e+this.floorlv+this.g.rng.randRange(1,this.floorlv)));for(let t=0;t<n;t++){let e=this.g.rng.randRange(0,i.length-1),[r,n]=i[e];i.splice(e,1),0===t?this.player=[r,n]:this.g.spawnRandomMonster(r,n,this.floorlv)}for(let r=0;r<e;r++)for(let e=0;e<t;e++){let t=this.tiles.get(e,r);"J"===t&&(t=this.g.choose(["~","."])),"~"===t&&this.tiles.set(e,r,this.g.choose(this.decor)),"."===t&&this.tiles.set(e,r,this.g.choose(tz))}}pasteroom(t,e,r){let i=this.areaBank[r],n=this.g.choose(i),J=i.indexOf(n);i.splice(J,1);let o=new t5(n[0].length,n.length,(t,e)=>n[e][t]);this.g.rng.bool()&&(o=o.flipH()),this.g.rng.bool()&&(o=o.flipV()),this.tiles.paste(t,e,o)}}let t4=t=>t instanceof Date,t9=t=>0===Object.keys(t).length,t7=t=>null!=t&&"object"==typeof t,et=(t,...e)=>Object.prototype.hasOwnProperty.call(t,...e),ee=t=>t7(t)&&t9(t),er=()=>Object.create(null),ei=(t,e)=>{if(t===e)return{};if(!t7(t)||!t7(e))return e;let r=Object.keys(t).reduce((t,r)=>(et(e,r)||(t[r]=void 0),t),er());return t4(t)||t4(e)?t.valueOf()==e.valueOf()?{}:e:Object.keys(e).reduce((r,i)=>{if(!et(t,i))return r[i]=e[i],r;let n=ei(t[i],e[i]);return ee(n)&&!t4(n)&&(ee(t[i])||!ee(e[i]))||(r[i]=n),r},r)};var en=a("7jSc9");let eJ=(t=21)=>{let e="",r=t;for(;r--;)e+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[64*Math.random()|0];return e};class eo{constructor(t){this.name=t,this.data={}}add(t,e){this.data[t.id]=e}remove(t){delete this.data[t.id]}get(t){return this.data[t.id]}}class es{constructor(t,e,...r){for(let i of(this.ecs=t,this.id=e,this.components=new Set,this.prefabs=[],r)){let e=i.data();for(let r in e)this.add(t.getComponent(r),e[r]);this.prefabs.push(i.id)}}add(t,e){return this.components.add(t),t.add(this,J(en)({},e)),this[t.name]=t.get(this),this}get(t){return t.get(this)}has(t){return this.components.has(t)}remove(t){this.components.delete(t),t.remove(this),delete this[t.name]}data(){let t={};for(let e of this.components)t[e.name]=e.get(this);return t}diffData(){return ei(this.prefabData(),this.data())}prefabNames(){return this.prefabs}prefabData(){return J(en)({},...this.prefabs.map(t=>this.ecs.getPrefab(t).data()))}}class ea extends es{constructor(t,e,...r){super(t,e,...r),this.destroyed=!1}add(t,e){return super.add(t,e),this.ecs.update(this),this}remove(t){super.remove(t),this.ecs.update(this)}destroy(){if(!this.destroyed){for(let t of this.components)t.remove(this);this.ecs.remove(this),this.destroyed=!0}}}class eh extends es{}class el{constructor(t,e){this.match=e,this.entities=new Set(t.filter(e))}add(t){this.match(t)?this.entities.add(t):this.entities.delete(t)}remove(t){this.entities.delete(t)}get(){return Array.from(this.entities)}}let eu=new class{constructor(){this.components={},this.entities=new Map,this.idGenerator=()=>eJ(),this.prefabs={},this.queries=[]}clear(){let t=this.remove.bind(this);this.entities.forEach(t)}register(t){let e=new eo(t);return this.components[t]=e,e}getEntity(t){return this.entities.get(t)}getComponent(t){let e=this.components[t];if(!e)throw`Unknown component: ${t}`;return e}nextId(){return this.idGenerator()}entity(...t){let e=new ea(this,this.nextId(),...t.map(t=>this.getPrefab(t)));return this.attach(e)}prefab(t,...e){let r=new eh(this,t,...e);return this.prefabs[t]=r,r}getPrefab(t){let e=this.prefabs[t];if(!e)throw`Unknown prefab: ${t}`;return e}attach(t){for(let e of(this.entities.set(t.id,t),this.queries))e.add(t);return t}update(t){for(let e of this.queries)e.add(t)}remove(t){for(let e of this.queries)e.remove(t);this.entities.delete(t.id)}query({all:t,any:e,none:r}={},i=!0){let n=t?e=>t.every(t=>e.has(t)):()=>!0,J=e?t=>e.some(e=>t.has(e)):()=>!0,o=r?t=>!r.some(e=>t.has(e)):()=>!0,s=new el(Array.from(this.entities.values()),t=>J(t)&&n(t)&&o(t));return i&&this.queries.push(s),s}find(t={}){return this.query(t,!1).get()}};window.ecs=eu,eu.register("AI");let ec=eu.register("Appearance"),ef=eu.register("Position"),ed=eu.register("Stats"),ep=eu.register("PlayerTag");var eg={};eg={all:"logo:a\r\nname: Awfs\r\ndesc: Awfs are tiny humanoids who dwell in the hills surrounding Graydnmuch. Once almost feral, they've since learnt from the humans they scavenge from and have devised their own society, complete with religions and technology.\r\ndie:The awf collapses with a wail.\r\ndrop:JUNK, 85, TECH_CONSUMABLE, 35\r\ntags: INTELLIGENT, MUNDANE, HUMANOID, CHAOTIC, NEUTRAL\r\n"};var ey={};ey={awf:"cat:a\r\ncol:silver\r\nid:awf_d\r\nname:desperate awf\r\ndesc:A little guy with a scarred turquoise body. He draws his cloak around himself and mutters.\r\nlevel:1\r\natts:10, 9, 6\r\ntags:SINGULAR\r\n\r\ncat:a\r\ncol:white\r\nname:mulnishel\r\nhname:awfen hermit\r\ndesc:This tiny awf has blindingly-white flesh and an anti-social scowl.\r\nlevel:2\r\natts:7, 16, 7\r\nweapon:club_basic\r\ntags:SINGULAR, CAST_ONCE\r\nattack:hex, 0, 1, 0, DAMAGE:7, DOUBLE_DAMAGE:LAWFUL\r\n"};var em={};em="black: 0, 0, 0\r\ncharcoal: 55, 55, 55\r\nsilver: 135, 135, 135\r\nwhite: 255, 255, 255\r\nred: 255, 25, 25\r\nsilver brown: 199, 199, 103\r\nsilver purp: 207, 111, 199\r\nsilver cyan: 111, 199, 199\r\nsilver green: 111, 207, 87\r\nsilver blue: 111, 111, 207\r\ndgreen: 0, 207, 0\r\ngreen: 39, 255, 39\r\ndblue: 7, 7, 255\r\nblue: 55, 55, 255\r\ndcyan: 39, 151, 151\r\ncyan: 71, 255, 255\r\ndpurp: 151, 39, 151\r\npurp: 255, 71, 255\r\ndyel: 151, 151, 39\r\nyel: 255, 255, 71\r\ndora: 191, 111, 11\r\nora: 255, 205, 21\r\n";class ew extends Error{constructor(t,e){super(`(line ${e}) ${t}`),this.line=e}}class eb{constructor(t){this.parsers=t}parse(t){let e;let r=[],i=0;for(let n of t.trim().replace(/\r/g,"").split("\n")){i++;let t=n.trim();if(!t){e&&r.push(e),e=void 0;continue}let J=t.indexOf(":");if(J<0)throw new ew("missing colon",i);let o=t.substring(0,J).toLowerCase(),s=t.substring(J+1);if(e||(e=this.blank()),!this.parsers[o])throw new ew(`invalid field: ${o}`,i);let a=this.parsers[o];if(!a.check(s))throw new ew(`invalid value for ${o}: ${s}`,i);try{e[o]=a.apply(s,e[o])}catch(t){throw new ew(t.message,i)}}return e&&r.push(e),r}}function ev(t,e=","){return t.split(e).map(t=>t.trim())}function e_(t){return"string"==typeof t&&t.length>0}function eA(t){return parseInt(t,10)}let eE=/^(0|[1-9][0-9]*)$/;class ex{check(t){return e_(t)&&eE.test(t.trim())}apply(t){return eA(t.trim())}}class eC{check(){return!0}apply(t){return t.trim()}}class eB{check(t){return t.trim().length>0}apply(t,e){let r=ev(t.trim()),i=e;return r.forEach(t=>{i.includes(t)||(i=i.concat(t))}),r}}function eT(t){return!isNaN(parseInt(t,10))}let eR=[new class{constructor(t=4){this.length=t}check(t){let[e,r,i,n]=ev(t);return e_(e)&&e.startsWith("ADD:")&&eT(r)&&e_(i)&&eT(n)}apply(t,e){let[r,i,n,J]=ev(t);return e.concat({type:"ADD",name:r.substring(4),power:eA(i),save:n,difficulty:eA(J)})}},new class{constructor(t=1){this.length=t}check(t){let[e,r]=ev(t,":");return"DAMAGE"===e&&eT(r)}apply(t,e){let[,r]=ev(t,":");return e.concat({type:"DAMAGE",amount:eA(r)})}},new class{constructor(t=1){this.length=t}check(t){let[e,r]=ev(t,":");return"DOUBLE_DAMAGE"===e&&e_(r)}apply(t,e){let[,r]=ev(t,":");return e.concat({type:"DOUBLE_DAMAGE",criterion:r})}},new class{constructor(t=1){this.length=t}check(t){return"KNOCKBACK"===t}apply(t,e){return e.concat({type:"KNOCKBACK"})}}];class eO{check(t){let[e,r,i,n]=ev(t);return e_(e)&&eT(r)&&eT(i)&&eT(n)}apply(t,e){let[r,i,n,J,...o]=ev(t),s={name:r,hp:eA(i),sp:eA(n),mp:eA(J),effects:[]},a=o.slice();for(;a.length>0;){let t=eR.find(t=>{if(t.length>a.length)return!1;let e=a.slice(0,a.length).join(",");return t.check(e)});if(!t)throw Error(`unknown attack effect: ${a[0]}`);let e=a.slice(0,t.length).join(",");s.effects=t.apply(e,s.effects),a=a.slice(t.length)}return e.concat(s)}}class eL{check(t){let e=ev(t);if(e.length%2)return!1;for(let t=0;t<e.length;t+=2)if(!eT(e[t+1]))return!1;return!0}apply(t,e){let r={},i=ev(t);for(let t=0;t<i.length;t+=2){let e=i[t],n=i[t+1];r[e]=eA(n)}return{...e,...r}}}class eU{check(t){let[e,r]=ev(t);return e_(e)&&eT(r)}apply(t,e){let[r,i]=ev(t);return e.concat({name:r,power:eA(i)})}}class eI extends eb{constructor(){super({logo:new eC,name:new eC,desc:new eC,die:new eC,drop:new eL,tags:new eB,status:new eU,attack:new eO})}blank(){return{logo:"?",name:"",desc:"",die:"",drop:{},tags:[],status:[],attack:[]}}}class eD{check(t){let[e,r,i]=ev(t);return eT(e)&&eT(r)&&eT(i)}apply(t){let[e,r,i]=ev(t);return[eA(e),eA(r),eA(i)]}}class eF extends eb{constructor(){super({id:new eC,cat:new eC,col:new eC,name:new eC,hname:new eC,desc:new eC,die:new eC,level:new ex,atts:new eD,wake:new ex,idealrange:new ex,tags:new eB,status:new eU,attack:new eO,weapon:new eC})}blank(){return{cat:"?",col:"",name:"",desc:"",level:0,atts:[0,0,0],tags:[],status:[],attack:[]}}}let eS=/^([A-Za-z ]+):\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*$/gm;class eM{check(t){return eS.test(t)}apply(t,e){return{...e,...Object.fromEntries(Array.from(t.matchAll(eS)).map(([,t,e,r,i])=>[t,B(eA(e),eA(r),eA(i))]))}}}class eN extends Error{constructor(t,e){super(`[${t}]`),this.filename=t,e instanceof ew&&(this.message+=` ${e.message}`)}}function eP(t,e,r=""){let i=[];for(let n in e){let J=e[n];try{i.push(...t.parse(J))}catch(t){throw new eN(n+r,t)}}return i}let ek=(t,e=.25)=>B(Math.floor((t>>24&255)*e),Math.floor((t>>16&255)*e),Math.floor((t>>8&255)*e));class eK{constructor(t){this.g=t,this.dirty=!0,this.drawable=t.ecs.query({all:[ec,ef]});let e=()=>this.dirty=!0;t.on("move",e),t.on("scroll",e)}process(){if(!this.dirty)return;let{map:t,scrollX:e,scrollY:r,term:i}=this.g;i.clear();for(let n=0;n<i.height;n++){let J=n+r;for(let r=0;r<i.width;r++){let o=r+e,s=i.getCell(r,n);if(s?.explored&&t.contains(o,J)){let e=t.get(o,J),s=e.colour;i.isVisible(r,n)||(s=ek(s)),i.drawChar(r,n,e.glyph,s)}}}this.drawable.get().map(t=>{let n=t.get(ec),J=t.get(ef),o=J.x-e,s=J.y-r;i.isVisible(o,s)&&i.drawChar(o,s,n.glyph,n.colour)}),this.dirty=!1}}let eV={glyph:" ",colour:0,blocks:!0,opaque:!0};class ej{constructor(t){this.g=t,this.dirty=!0,this.scrolled=!0,t.on("move",t=>{t.has(ep)&&(this.dirty=!0)}),t.on("scroll",([t,e])=>{this.preserveExplored(),this.g.scrollX=t,this.g.scrollY=e,this.dirty=!0,this.scrolled=!0})}process(){if(!this.dirty)return;let{player:t,scrollX:e,scrollY:r,term:i}=this.g;this.scrolled&&this.scroll(e,r);let n=t.get(ef),J=n.x-e,o=n.y-r;i.getCell(J,o)&&(i.computeFov(J,o,5),i.updateExplored()),this.dirty=!1}preserveExplored(){let{map:t,scrollX:e,scrollY:r,term:i}=this.g;for(let n=0;n<i.height;n++){let J=n+r;for(let r=0;r<i.width;r++){let o=r+e;if(t.contains(o,J)){let e=t.get(o,J);e.explored||=i.getCell(r,n)?.explored}}}}scroll(t,e){let{map:r,term:i}=this.g;for(let n=0;n<i.height;n++){let J=n+e;for(let e=0;e<i.width;e++){let o=e+t,s=r.contains(o,J)?r.get(o,J):eV,a=i.getCell(e,n);a.blocked=s.blocks,a.blockedSight=s.opaque,a.explored=s.explored||!1}}this.scrolled=!1}}let eG=new Map([[Y.VK_NUMPAD7,new M(-1,-1)],[Y.VK_NUMPAD8,new M(0,-1)],[Y.VK_NUMPAD9,new M(1,-1)],[Y.VK_NUMPAD4,new M(-1,0)],[Y.VK_NUMPAD5,new M(0,0)],[Y.VK_NUMPAD6,new M(1,0)],[Y.VK_NUMPAD1,new M(-1,1)],[Y.VK_NUMPAD2,new M(0,1)],[Y.VK_NUMPAD3,new M(1,1)],[Y.VK_HOME,new M(-1,-1)],[Y.VK_UP,new M(0,-1)],[Y.VK_PAGE_UP,new M(1,-1)],[Y.VK_LEFT,new M(-1,0)],["Clear",new M(0,0)],[Y.VK_RIGHT,new M(1,0)],[Y.VK_END,new M(-1,1)],[Y.VK_DOWN,new M(0,1)],[Y.VK_PAGE_DOWN,new M(1,1)],[Y.VK_Y,new M(-1,-1)],[Y.VK_K,new M(0,-1)],[Y.VK_U,new M(1,-1)],[Y.VK_H,new M(-1,0)],[Y.VK_PERIOD,new M(0,0)],[Y.VK_L,new M(1,0)],[Y.VK_B,new M(-1,1)],[Y.VK_J,new M(0,1)],[Y.VK_N,new M(1,1)]]);class eX{constructor(t){this.g=t}process(){let{player:t,term:e}=this.g,r=function(t){for(let[e,r]of eG.entries())if(t.isKeyPressed(e))return r}(e);if(!r||0===r.x&&0===r.y)return;if(e.isKeyDown(Y.VK_CONTROL_LEFT)){let t=this.g.scrollX+10*r.x,e=this.g.scrollY+10*r.y;this.g.emit("scroll",[t,e]);return}let i=t.get(ef),{x:n,y:J}=i;this.g.canMove(n,J,r.x,r.y)&&(i.x+=r.x,i.y+=r.y,this.g.emit("move",t,[n,J]))}}class eY extends J(u){constructor(t,e,r){super(),this.width=e,this.height=r,this.debug=J(l)("game"),this.emit=(t,...e)=>(this.debug("event",t,...e),super.emit(t,...e)),this.ecs=eu,this.blockers=eu.query({all:[ef]}),eu.prefab("player").add(ec,{colour:T.WHITE,glyph:64}).add(ed,this.getPlayerStats(3,3,3,1)).add(ep,{}),this.player=eu.entity("player"),this.rng=A,this.debug("seed",this.rng.seed),this.scrollX=0,this.scrollY=0,this.term=new ti(t,e,r),this.gui=new K(this.term),this.installCheats();try{let[t,e]=this.load();this.player.add(ef,{x:t,y:e})}catch(t){this.fatal(t);return}this.systems=[eX,ej,eK].map(t=>new t(this)),this.term.update=this.update.bind(this)}update(){for(let t of this.systems)t.process()}load(){this.categories=eP(new eI,eg,".category"),this.monsters=eP(new eF,ey,".monster"),this.palette=new eM().apply(J(em),{});let t=new t8(this,48);return(this.map=t.map,t.player)?t.player:[4,4]}installCheats(){window.stats=t=>{var e,r;let i=this.monsters.find(e=>e.name===t);return i?(e=this.getMonsterStats(i),r=this.player.get(ed),{MaxHP:t1(e),HPRegenChance:t2(e),HPRegenAmount:Math.max(1,t0(e.body)),MaxStamina:e.body,StaminaRegenChance:t2(e),StaminaRegenAmount:Math.max(1,t0(e.body)),MaxMana:e.mind,ManaRegenChance:t0(e.mind+e.level),ManaRegenAmount:Math.max(1,t0(e.mind)),HitChance:224-r.spirit,HitDamage:0+t0(e.body)-0}):"unknown"}}fatal(t){let e=t instanceof Error?t:Error(JSON.stringify(t));console.error(e);let r=new H("Fatal Error",e.message);this.gui.add(r),this.gui.draw()}choose(t){return this.rng.choice(t)}canMove(t,e,r,i){return!this.isBlocked(t+r,e+i)&&!(r&&i&&this.isBlocked(t+r,e)&&this.isBlocked(t,e+i))}isBlocked(t,e){if(this.map.isBlocked(t,e))return!0;for(let r of this.blockers.get()){let i=r.get(ef);if(i.x===t&&i.y===e)return!0}return!1}spawnRandomMonster(t,e,r){let i=this.choose(this.monsters);return this.spawnMonster(t,e,i)}spawnMonster(t,e,r){let{categories:i,ecs:n,palette:J}=this,o=i.find(t=>t.logo===r.cat),s=J[r.col]||J.white,a=n.entity().add(ec,{colour:s,glyph:r.cat.charCodeAt(0)}).add(ef,{x:t,y:e}).add(ed,this.getMonsterStats(r));return this.debug("spawn %d,%d %s (%s)",t,e,r.name,o?.name),a}getMonsterStats(t){let{level:e}=t,[r,i,n]=t.atts,J={level:e,body:r,mind:i,spirit:n,talent:0,hp:0,mana:0,stamina:0};return J.hp=t1(J),J.mana=J.mind,J.stamina=J.body,J}getPlayerStats(t,e,r,i){let n={level:1,mind:10*t,body:10*e,spirit:10*r,talent:i,hp:0,mana:0,stamina:0};return n.hp=t1(n),n.mana=n.mind,n.stamina=n.body,n}}window.addEventListener("load",()=>{let t=document.getElementById("main");t.focus();let e=new eY(t,80,60);window.g=e})}();
//# sourceMappingURL=index.935184d5.js.map
